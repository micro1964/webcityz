FD31.installer("Komento","definitions",function(a){a.module(["komento/admin.comment.actions","komento/komento.common","komento/komento.language","komento/syntaxhighlighter","komento/admin.language","komento/admin.database","komento/admin.integrations.customsmileys","komento/admin.report.actions","komento/dashboard.comment.item","komento/dashboard.flag.item","komento/komento.admincomments","komento/komento.bbcode","komento/komento.commentform","komento/komento.commentitem","komento/komento.commentlist","komento/sharelinks","komento/markitup","komento/komento.commenttools","komento/komento.famelist","komento/komento.insertvideo","komento/komento","komento/komento.profile","komento/komento.upload","komento/location","komento/migrator.actions","komento/migrator.common","komento/migrator.custom","komento/migrator.progress"]),a.require.template.loader(["komento/dialogs/error","komento/dialogs/delete.affectchild","komento/comment/edit.form","komento/dialogs/unpublish.affectchild","komento/dialogs/delete.single","komento/comment/item/edit.form","komento/dialogs/delete.attachment","komento/notifications/new.comment","komento/comment/form/uploadrow"]),a.require.language.loader(["COM_KOMENTO_ERROR","COM_KOMENTO_LOADING","COM_KOMENTO_UNPUBLISHED","COM_KOMENTO_PUBLISHED","COM_KOMENTO_NOFLAG","COM_KOMENTO_SPAM","COM_KOMENTO_OFFENSIVE","COM_KOMENTO_OFFTOPIC","COM_KOMENTO_COMMENTS_LOADING","COM_KOMENTO_COMMENT_EDIT","COM_KOMENTO_COMMENT_EDIT_CANCEL","COM_KOMENTO_COMMENT_EDITTED_BY","COM_KOMENTO_COMMENT_REPLY","COM_KOMENTO_COMMENT_REPLY_CANCEL","COM_KOMENTO_COMMENT_REPORT","COM_KOMENTO_COMMENT_REPORTED","COM_KOMENTO_COMMENT_SHARE","COM_KOMENTO_COMMENT_SHARE_CANCEL","COM_KOMENTO_COMMENT_LIKE","COM_KOMENTO_COMMENT_UNLIKE","COM_KOMENTO_COMMENT_STICK","COM_KOMENTO_COMMENT_UNSTICK","COM_KOMENTO_COMMENT_WHERE_ARE_YOU","COM_KOMENTO_COMMENT_PEOPLE_WHO_LIKED_THIS","COM_KOMENTO_FORM_LEAVE_YOUR_COMMENTS","COM_KOMENTO_FORM_IN_REPLY_TO","COM_KOMENTO_FORM_SUBMIT","COM_KOMENTO_FORM_REPLY","COM_KOMENTO_FORM_NOTIFICATION_SUBMITTED","COM_KOMENTO_FORM_NOTIFICATION_PENDING","COM_KOMENTO_FORM_NOTIFICATION_COMMENT_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_COMMENT_TOO_SHORT","COM_KOMENTO_FORM_TNC","COM_KOMENTO_FORM_AGREE_TNC","COM_KOMENTO_FORM_OR_DROP_FILES_HERE","COM_KOMENTO_FORM_NOTIFICATION_NOTIFICATION_USERNAME_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_NAME_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_EMAIL_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_EMAIL_INVALID","COM_KOMENTO_FORM_NOTIFICATION_WEBSITE_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_WEBSITE_INVALID","COM_KOMENTO_FORM_NOTIFICATION_TNC_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_CAPTCHA_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBED","COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBE_CONFIRMATION_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBE_ERROR","COM_KOMENTO_FORM_NOTIFICATION_UNSUBSCRIBED","COM_KOMENTO_FORM_NOTIFICATION_MAX_FILE_SIZE","COM_KOMENTO_FORM_NOTIFICATION_MAX_FILE_ITEM","COM_KOMENTO_FORM_NOTIFICATION_FILE_EXTENSION","COM_KOMENTO_FORM_NOTIFICATION_UPLOAD_NOT_ALLOWED","COM_KOMENTO_FORM_LOCATION_AUTODETECT","COM_KOMENTO_FORM_LOCATION_DETECTING","COM_KOMENTO_BBCODE_BOLD","COM_KOMENTO_BBCODE_ITALIC","COM_KOMENTO_BBCODE_UNDERLINE","COM_KOMENTO_BBCODE_LINK","COM_KOMENTO_BBCODE_LINK_TEXT","COM_KOMENTO_BBCODE_PICTURE","COM_KOMENTO_BBCODE_VIDEO","COM_KOMENTO_BBCODE_BULLETLIST","COM_KOMENTO_BBCODE_NUMERICLIST","COM_KOMENTO_BBCODE_BULLET","COM_KOMENTO_BBCODE_QUOTE","COM_KOMENTO_BBCODE_CLEAN","COM_KOMENTO_BBCODE_SMILE","COM_KOMENTO_BBCODE_HAPPY","COM_KOMENTO_BBCODE_SURPRISED","COM_KOMENTO_BBCODE_TONGUE","COM_KOMENTO_BBCODE_UNHAPPY","COM_KOMENTO_BBCODE_WINK","COM_KOMENTO_INSERT_VIDEO","COM_KOMENTO_CONFIRM_DELETE_AFFECT_ALL_CHILD","COM_KOMENTO_CONFIRM_DELETE","COM_KOMENTO_DELETE_COMMENT","COM_KOMENTO_DELETE_ALL_CHILD","COM_KOMENTO_DELETE_MOVE_CHILD_UP","COM_KOMENTO_DELETING","COM_KOMENTO_CONFIRM_PUBLISH_AFFECT_ALL_CHILD","COM_KOMENTO_PUBLISH_ALL_CHILD","COM_KOMENTO_PUBLISH_SINGLE","COM_KOMENTO_CHILD_UNPUBLISHED","COM_KOMENTO_PARENT_PUBLISHED","COM_KOMENTO_MIGRATORS_LOG_COMPLETE","COM_KOMENTO_MIGRATORS_PROGRESS_DONE","COM_KOMENTO_YES_OPTION","COM_KOMENTO_NO_OPTION","COM_KOMENTO_ACL_RECOMMENDED","COM_KOMENTO_PUBLISH_ITEM","COM_KOMENTO_UNPUBLISH_ITEM","COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_UPDATING","COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_COMPLETED","COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_ERROR","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_UPDATING_STAGE1","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_UPDATING_STAGE2","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_ERROR","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_COMPLETED"]),function(){var b=["komento/dialog/default","komento/fancybox/default"],c=a.stylesheet({content:""})?"resolve":"reject";a.each(b,function(b,d){a.require.stylesheet.loader(d)[c]()})}()}),FD31.installer("Komento","scripts",function($){Komento.module("admin.comment.actions",function(a){var b=this;Komento.require().library("dialog").stylesheet("dialog/default").script("komento.common","admin.language").done(function(){var c={};"1.5"==Komento.options.jversion?(c.published="images/tick.png",c.unpublished="images/publish_x.png"):(c.published="templates/bluestork/images/admin/tick.png",c.unpublished="templates/bluestork/images/admin/publish_x.png"),Komento.actions={loadReplies:function(b){var c=a(".kmt-row").length;Komento.ajax("admin.views.comments.loadreplies",{parentId:b,startCount:c},{success:function(c){a("#kmt-"+b).after(c).find(".linked-cell").text("-"),a(".kmt-row").each(function(a,b){var c=a%2;b.removeClass("row1","row0").addClass("row"+c)}),Komento.options.jversion<"3.0"&&a("#toggle").attr("onClick","checkAll("+a(".kmt-row").length+");")}})},submit:function(b,c){0!=a(".foundryDialog").length&&a(".foundryDialog").controller().close(),Komento.actions.affectchild=c;var d=new Array,e=new Array;a('input[type="checkbox"]:checked').each(function(c,f){if(""!=f.value){d.push(f.value),e.push(a("#kmt-"+f.value));var g;g="unstick"==b||"stick"==b?"sticked":"published",a("#kmt-"+f.value).find("."+g+"-cell a img").attr("src",Komento.options.spinner)}}),Komento.ajax("admin.views.comments."+b,{ids:d,affectchild:c},{success:function(){var c=[],d=[];a.each(e,function(a,e){Komento.actions[b](e),e.attr("childs")>0&&c.push(1),0!=e.attr("parentid")&&d.push(1)}),("publish"==b&&d.length>0||"publish"!=b&&c.length>0)&&Komento.actions[b+"Dialog"]()},fail:function(){}})},publish:function(b){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.published):b.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),Komento.actions.publishParent(b),Komento.actions.publishChild(b)},publishParent:function(b){if(b.exists()){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.published):b.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),0!=b.attr("parentid")&&Komento.actions.publishParent(a("#kmt-"+b.attr("parentid")))}},publishChild:function(b){if(b.exists()){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");if(b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.published):b.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),1==Komento.actions.affectchild&b.attr("childs")>0){var e=b.attr("id").split("-")[1];Komento.actions.publishChild(a('.kmt-row[parentid="'+e+'"]'))}}},publishDialog:function(){a.dialog("<p>"+a.language("COM_KOMENTO_PARENT_PUBLISHED")+"</p>")},publishParentDialog:function(){a.dialog("<p>"+a.language("COM_KOMENTO_PARENT_PUBLISHED")+"</p>")},unpublish:function(b){if(b.exists()){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish");if(b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_PUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.unpublished):b.find(".published-cell i").removeClass("icon-publish").addClass("icon-unpublish"),b.attr("childs")>0){var e=b.attr("id").split("-")[1];Komento.actions.unpublish(a('.kmt-row[parentid="'+e+'"]'))}}},unpublishDialog:function(){a.dialog("<p>"+a.language("COM_KOMENTO_CHILD_UNPUBLISHED")+"</p>")},stick:function(a){var b=a.find(".sticked-cell a").attr("onclick").replace("stick","unstick");a.find(".sticked-cell a").attr("onclick",b),Komento.options.jversion<"3.0"?a.find(".sticked-cell a img").attr("src","components/com_komento/assets/images/sticked.png"):a.find(".sticked-cell i").removeClass("icon-star-empty").addClass("icon-star")},stickDialog:function(){},unstick:function(a){var b=a.find(".sticked-cell a").attr("onclick").replace("unstick","stick");a.find(".sticked-cell a").attr("onclick",b),Komento.options.jversion<"3.0"?a.find(".sticked-cell a img").attr("src","components/com_komento/assets/images/unsticked.png"):a.find(".sticked-cell i").removeClass("icon-star").addClass("icon-star-empty")},unstickDialog:function(){}},Komento.prepare={checkChild:function(){var b=[];return a('input[type="checkbox"]:checked').each(function(c,d){""!=d.value&&a("#kmt-"+d.value).attr("childs")>0&&b.push(1)}),b.length>0?!0:!1},remove:function(){var b,c;Komento.prepare.checkChild()?(b=a.language("COM_KOMENTO_CONFIRM_DELETE_AFFECT_ALL_CHILD"),c='<button onclick="Komento.prepare.removeall()">'+a.language("COM_KOMENTO_DELETE_ALL_CHILD")+"</button>",c+='<button onclick="Komento.prepare.removesingle()">'+a.language("COM_KOMENTO_DELETE_MOVE_CHILD_UP")+"</button>"):(b=a.language("COM_KOMENTO_CONFIRM_DELETE"),c='<button onclick="Komento.prepare.removeall()">'+a.language("COM_KOMENTO_DELETE_COMMENT")+"</button>");var d='<div style="text-align: center;"><p>'+b+"</p>"+c+"</div>";a.dialog(d)},removeall:function(){prepareSubmit("remove",1)},removesingle:function(){prepareSubmit("remove",0)},publish:function(){if(Komento.prepare.checkChild()){var b=a.language("COM_KOMENTO_CONFIRM_PUBLISH_AFFECT_ALL_CHILD"),c='<button onclick="Komento.prepare.publishall()">'+a.language("COM_KOMENTO_PUBLISH_ALL_CHILD")+"</button>";c+='<button onclick="Komento.prepare.publishsingle()">'+a.language("COM_KOMENTO_PUBLISH_SINGLE")+"</button>";var d='<div style="text-align: center;"><p>'+b+"</p>"+c+"</div>";a.dialog(d)}else Komento.actions.submit("publish",1)},publishall:function(){Komento.actions.submit("publish",1)},publishsingle:function(){Komento.actions.submit("publish",0)},unpublish:function(){Komento.actions.submit("unpublish",1)},stick:function(){Komento.actions.submit("stick",1)},unstick:function(){Komento.actions.submit("unstick",1)},saveColumns:function(){submitform("saveColumns")}},window.submitbutton=function(a){Komento.prepare[a]()},window.prepareSubmit=function(b,c){0!=a(".foundryDialog").length&&a(".foundryDialog").controller().close(),document.adminForm.affectchild.value=c,submitform(b)},window.listItemTask=function(a,b){var c=document.adminForm,d=c[a];if(d){for(var e=0;!0;e++){var f=c["cb"+e];if(!f)break;f.checked=!1}d.checked=!0,c.boxchecked.value=1,submitbutton(b)}return!1},b.resolve()})}),Komento.module("komento.common",function(a){var b=this;Komento.require().library("ui/effect","scrollTo").script("komento.language").done(function(){var c=a.fn.hide,d=a.fn.show,e=function(b){a.scrollTo(b,500)};a.fn.hide=function(){return c.apply(this,arguments),this.addClass("hidden"),this},a.fn.show=function(){return d.apply(this,arguments),this.removeClass("hidden"),this},a.fn.scroll=function(){e(this)},a.fn.highlight=function(){return this.effect("highlight",{color:"#FDFFE0"},2e3),this},a.fn.enable=function(){return this.removeClass("disabled"),this},a.fn.disable=function(){return this.addClass("disabled"),this},a.fn.switchOn=function(){return this.removeClass("cancel"),this},a.fn.switchOff=function(){return this.addClass("cancel"),this},a.fn.checkSwitch=function(){return this.hasClass("cancel")?!1:!0},a.fn.checkClick=function(){return this.hasClass("disabled")?!1:(this.addClass("disabled"),!0)},a.fn.clearClick=function(){return this.removeClass("disabled"),this},a.fn.loading=function(){return this.addClass("loading"),this},a.fn.doneLoading=function(){return this.removeClass("loading"),this},a.fn.exists=function(){return this.length>0?!0:!1},a.fn.acl=function(a,b,c){Komento.ajax("site.views.komento.checkAcl",{component:a,rule:b},{success:function(){return c&&c()}})},a.fn.permission=function(a,b,c){Komento.ajax("site.views.komento.checkPermission",{id:a,action:b},{success:function(){return c&&c()}})},a.shortenlink=function(a,b){Komento.ajax("site.views.komento.shortenLink",{url:a},{success:function(a){return Komento.shortenLink=a,b&&b(a)}})},a.stripHtml=function(b){return a("<div>"+b+"</div>").text()},a.bugReport=function(b){Komento.require().library("dialog").stylesheet("dialog/default").view("dialogs/error").done(function(){a.dialog({title:a.language("COM_KOMENTO_ERROR"),width:500,customClass:"kmt-dialog",content:Komento.View("dialogs/error",{status:b.status,statusText:b.statusText,responseText:a.stripHtml(b.responseText)})})})},a.loadSHBrushes=function(){Komento.require().script("syntaxhighlighter").done(function(){a(".kmt-item pre code").each(function(a,b){hljs.highlightBlock(b)})})},b.resolve()})}),Komento.module("komento.language",function(){var b=this;Komento.require().language("COM_KOMENTO_ERROR","COM_KOMENTO_LOADING","COM_KOMENTO_UNPUBLISHED","COM_KOMENTO_PUBLISHED","COM_KOMENTO_NOFLAG","COM_KOMENTO_SPAM","COM_KOMENTO_OFFENSIVE","COM_KOMENTO_OFFTOPIC","COM_KOMENTO_COMMENTS_LOADING","COM_KOMENTO_COMMENT_EDIT","COM_KOMENTO_COMMENT_EDIT_CANCEL","COM_KOMENTO_COMMENT_EDITTED_BY","COM_KOMENTO_COMMENT_REPLY","COM_KOMENTO_COMMENT_REPLY_CANCEL","COM_KOMENTO_COMMENT_REPORT","COM_KOMENTO_COMMENT_REPORTED","COM_KOMENTO_COMMENT_SHARE","COM_KOMENTO_COMMENT_SHARE_CANCEL","COM_KOMENTO_COMMENT_LIKE","COM_KOMENTO_COMMENT_UNLIKE","COM_KOMENTO_COMMENT_STICK","COM_KOMENTO_COMMENT_UNSTICK","COM_KOMENTO_COMMENT_WHERE_ARE_YOU","COM_KOMENTO_COMMENT_PEOPLE_WHO_LIKED_THIS","COM_KOMENTO_FORM_LEAVE_YOUR_COMMENTS","COM_KOMENTO_FORM_IN_REPLY_TO","COM_KOMENTO_FORM_SUBMIT","COM_KOMENTO_FORM_REPLY","COM_KOMENTO_FORM_NOTIFICATION_SUBMITTED","COM_KOMENTO_FORM_NOTIFICATION_PENDING","COM_KOMENTO_FORM_NOTIFICATION_COMMENT_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_COMMENT_TOO_SHORT","COM_KOMENTO_FORM_TNC","COM_KOMENTO_FORM_AGREE_TNC","COM_KOMENTO_FORM_OR_DROP_FILES_HERE","COM_KOMENTO_FORM_NOTIFICATION_NOTIFICATION_USERNAME_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_NAME_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_EMAIL_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_EMAIL_INVALID","COM_KOMENTO_FORM_NOTIFICATION_WEBSITE_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_WEBSITE_INVALID","COM_KOMENTO_FORM_NOTIFICATION_TNC_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_CAPTCHA_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBED","COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBE_CONFIRMATION_REQUIRED","COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBE_ERROR","COM_KOMENTO_FORM_NOTIFICATION_UNSUBSCRIBED","COM_KOMENTO_FORM_NOTIFICATION_MAX_FILE_SIZE","COM_KOMENTO_FORM_NOTIFICATION_MAX_FILE_ITEM","COM_KOMENTO_FORM_NOTIFICATION_FILE_EXTENSION","COM_KOMENTO_FORM_NOTIFICATION_UPLOAD_NOT_ALLOWED","COM_KOMENTO_FORM_LOCATION_AUTODETECT","COM_KOMENTO_FORM_LOCATION_DETECTING","COM_KOMENTO_BBCODE_BOLD","COM_KOMENTO_BBCODE_ITALIC","COM_KOMENTO_BBCODE_UNDERLINE","COM_KOMENTO_BBCODE_LINK","COM_KOMENTO_BBCODE_LINK_TEXT","COM_KOMENTO_BBCODE_PICTURE","COM_KOMENTO_BBCODE_VIDEO","COM_KOMENTO_BBCODE_BULLETLIST","COM_KOMENTO_BBCODE_NUMERICLIST","COM_KOMENTO_BBCODE_BULLET","COM_KOMENTO_BBCODE_QUOTE","COM_KOMENTO_BBCODE_CLEAN","COM_KOMENTO_BBCODE_SMILE","COM_KOMENTO_BBCODE_HAPPY","COM_KOMENTO_BBCODE_SURPRISED","COM_KOMENTO_BBCODE_TONGUE","COM_KOMENTO_BBCODE_UNHAPPY","COM_KOMENTO_BBCODE_WINK","COM_KOMENTO_INSERT_VIDEO").done(function(){b.resolve()})}),Komento.module("syntaxhighlighter",function(){var b=this,c=new function(){function a(a){return a.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function b(a,b,c){return RegExp(b,"m"+(a.cI?"i":"")+(c?"g":""))}function d(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if("CODE"==c.nodeName)return c;if(3!=c.nodeType||!c.nodeValue.match(/\s+/))break}}function e(a,b){for(var c="",d=0;d<a.childNodes.length;d++)if(3==a.childNodes[d].nodeType){var f=a.childNodes[d].nodeValue;b&&(f=f.replace(/\n/g,"")),c+=f}else c+="BR"==a.childNodes[d].nodeName?"\n":e(a.childNodes[d]);return/MSIE [678]/.test(navigator.userAgent)&&(c=c.replace(/\r/g,"\n")),c}function f(a){var b=a.className.split(/\s+/);b=b.concat(a.parentNode.className.split(/\s+/));for(var c=0;c<b.length;c++){var d=b[c].replace(/^language-/,"");if(p[d]||"no-highlight"==d)return d}}function g(a){var b=[];return function c(a,d){for(var e=0;e<a.childNodes.length;e++)3==a.childNodes[e].nodeType?d+=a.childNodes[e].nodeValue.length:"BR"==a.childNodes[e].nodeName?d+=1:1==a.childNodes[e].nodeType&&(b.push({event:"start",offset:d,node:a.childNodes[e]}),d=c(a.childNodes[e],d),b.push({event:"stop",offset:d,node:a.childNodes[e]}));return d}(a,0),b}function h(b,c,d){function h(){return b.length&&c.length?b[0].offset!=c[0].offset?b[0].offset<c[0].offset?b:c:"start"==c[0].event?b:c:b.length?b:c}function i(b){for(var c="<"+b.nodeName.toLowerCase(),d=0;d<b.attributes.length;d++){var e=b.attributes[d];c+=" "+e.nodeName.toLowerCase(),void 0!==e.value&&e.value!==!1&&null!==e.value&&(c+='="'+a(e.value)+'"')}return c+">"}for(var e=0,f="",g=[];b.length||c.length;){var j=h().splice(0,1)[0];if(f+=a(d.substr(e,j.offset-e)),e=j.offset,"start"==j.event)f+=i(j.node),g.push(j.node);else if("stop"==j.event){var k,l=g.length;do l--,k=g[l],f+="</"+k.nodeName.toLowerCase()+">";while(k!=j.node);for(g.splice(l,1);l<g.length;)f+=i(g[l]),l++}}return f+a(d.substr(e))}function i(){function a(d,e,f){function i(a,b){for(var c=b.split(" "),d=0;d<c.length;d++){var e=c[d].split("|");h[e[0]]=[a,e[1]?Number(e[1]):1],g.push(e[0])}}if(!d.compiled){var g=[];if(d.k){var h={};if(d.lR=b(e,d.l||c.IR,!0),"string"==typeof d.k)i("keyword",d.k);else for(var j in d.k)d.k.hasOwnProperty(j)&&i(j,d.k[j]);d.k=h}f||(d.bWK&&(d.b="\\b("+g.join("|")+")\\s"),d.bR=b(e,d.b?d.b:"\\B|\\b"),d.e||d.eW||(d.e="\\B|\\b"),d.e&&(d.eR=b(e,d.e))),d.i&&(d.iR=b(e,d.i)),void 0===d.r&&(d.r=1),d.c||(d.c=[]),d.compiled=!0;for(var k=0;k<d.c.length;k++)"self"==d.c[k]&&(d.c[k]=d),a(d.c[k],e,!1);d.starts&&a(d.starts,e,!1)}}for(var d in p)p.hasOwnProperty(d)&&a(p[d].dM,p[d],!0)}function j(c,d){function e(a,b){for(var c=0;c<b.c.length;c++){var d=b.c[c].bR.exec(a);if(d&&0==d.index)return b.c[c]}}function f(a,b){if(u[a].e&&u[a].eR.test(b))return 1;if(u[a].eW){var c=f(a-1,b);return c?c+1:0}return 0}function g(a,b){return b.i&&b.iR.test(a)}function h(a,c){for(var d=[],e=0;e<a.c.length;e++)d.push(a.c[e].b);var f=u.length-1;do u[f].e&&d.push(u[f].e),f--;while(u[f+1].eW);return a.i&&d.push(a.i),d.length?b(c,d.join("|"),!0):null}function l(a,b){var c=u[u.length-1];void 0===c.t&&(c.t=h(c,t));var d;return c.t&&(c.t.lastIndex=b,d=c.t.exec(a)),d?[a.substr(b,d.index-b),d[0],!1]:[a.substr(b),"",!0]}function m(a,b){var c=t.cI?b[0].toLowerCase():b[0],d=a.k[c];return d&&d instanceof Array?d:!1}function n(b,c){if(b=a(b),!c.k)return b;var d="",e=0;c.lR.lastIndex=0;for(var f=c.lR.exec(b);f;){d+=b.substr(e,f.index-e);var g=m(c,f);g?(w+=g[1],d+='<span class="'+g[0]+'">'+f[0]+"</span>"):d+=f[0],e=c.lR.lastIndex,f=c.lR.exec(b)}return d+b.substr(e)}function o(a,b){var c;return c=""==b.sL?k(a):j(b.sL,a),b.r>0&&(w+=c.keyword_count,v+=c.r),'<span class="'+c.language+'">'+c.value+"</span>"}function q(a,b){return b.sL&&p[b.sL]||""==b.sL?o(a,b):n(a,b)}function r(b,c){var d=b.cN?'<span class="'+b.cN+'">':"";b.rB?(x+=d,b.buffer=""):b.eB?(x+=a(c)+d,b.buffer=""):(x+=d,b.buffer=c),u.push(b),v+=b.r}function s(b,c,d){var h=u[u.length-1];if(d)return x+=q(h.buffer+b,h),!1;var i=e(c,h);if(i)return x+=q(h.buffer+b,h),r(i,c),i.rB;var j=f(u.length-1,c);if(j){var k=h.cN?"</span>":"";for(x+=h.rE?q(h.buffer+b,h)+k:h.eE?q(h.buffer+b,h)+k+a(c):q(h.buffer+b+c,h)+k;j>1;)k=u[u.length-2].cN?"</span>":"",x+=k,j--,u.length--;var l=u[u.length-1];return u.length--,u[u.length-1].buffer="",l.starts&&r(l.starts,""),h.rE}if(g(c,h))throw"Illegal"}i.called||(i(),i.called=!0);var t=p[c],u=[t.dM],v=0,w=0,x="";try{var y,z=0;t.dM.buffer="";do{y=l(d,z);var A=s(y[0],y[1],y[2]);z+=y[0].length,A||(z+=y[1].length)}while(!y[2]);return{r:v,keyword_count:w,value:x,language:c}}catch(B){if("Illegal"==B)return{r:0,keyword_count:0,value:a(d)};throw B}}function k(b){var c={keyword_count:0,r:0,value:a(b)},d=c;for(var e in p)if(p.hasOwnProperty(e)){var f=j(e,b);f.language=e,f.keyword_count+f.r>d.keyword_count+d.r&&(d=f),f.keyword_count+f.r>c.keyword_count+c.r&&(d=c,c=f)}return d.language&&(c.second_best=d),c}function l(a,b,c){return b&&(a=a.replace(/^((<[^>]+>|\t)+)/gm,function(a,c){return c.replace(/\t/g,b)})),c&&(a=a.replace(/\n/g,"<br>")),a}function m(a,b,c){var m,n,d=e(a,c),i=f(a);if("no-highlight"!=i){i?m=j(i,d):(m=k(d),i=m.language);var o=g(a);o.length&&(n=document.createElement("pre"),n.innerHTML=m.value,m.value=h(o,g(n),d)),m.value=l(m.value,b,c);var p=a.className;if(p.match("(\\s|^)(language-)?"+i+"(\\s|$)")||(p=p?p+" "+i:i),/MSIE [678]/.test(navigator.userAgent)&&"CODE"==a.tagName&&"PRE"==a.parentNode.tagName){n=a.parentNode;var q=document.createElement("div");q.innerHTML="<pre><code>"+m.value+"</code></pre>",a=q.firstChild.firstChild,q.firstChild.cN=n.cN,n.parentNode.replaceChild(q.firstChild,n)}else a.innerHTML=m.value;a.className=p,a.result={language:i,kw:m.keyword_count,re:m.r},m.second_best&&(a.second_best={language:m.second_best.language,kw:m.second_best.keyword_count,re:m.second_best.r})}}function n(){if(!n.called){n.called=!0;for(var a=document.getElementsByTagName("pre"),b=0;b<a.length;b++){var e=d(a[b]);e&&m(e,c.tabReplace)}}}function o(){window.addEventListener?(window.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):window.attachEvent?window.attachEvent("onload",n):window.onload=n}var p={};this.LANGUAGES=p,this.highlight=j,this.highlightAuto=k,this.fixMarkup=l,this.highlightBlock=m,this.initHighlighting=n,this.initHighlightingOnLoad=o,this.IR="[a-zA-Z][a-zA-Z0-9_]*",this.UIR="[a-zA-Z_][a-zA-Z0-9_]*",this.NR="\\b\\d+(\\.\\d+)?",this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",this.BNR="\\b(0b[01]+)",this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",this.BE={b:"\\\\.",r:0},this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0},this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0},this.CLCM={cN:"comment",b:"//",e:"$"},this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"},this.HCM={cN:"comment",b:"#",e:"$"},this.NM={cN:"number",b:this.NR,r:0},this.CNM={cN:"number",b:this.CNR,r:0},this.BNM={cN:"number",b:this.BNR,r:0},this.inherit=function(a,b){var c={};for(var d in a)c[d]=a[d];if(b)for(var d in b)c[d]=b[d];return c}};c.LANGUAGES.bash=function(a){var b="true false",c={cN:"variable",b:"\\$([a-zA-Z0-9_]+)\\b"},d={cN:"variable",b:"\\$\\{(([^}])|(\\\\}))+\\}",c:[a.CNM]},e={cN:"string",b:'"',e:'"',i:"\\n",c:[a.BE,c,d],r:0},f={cN:"string",b:"'",e:"'",c:[{b:"''"}],r:0},g={cN:"test_condition",b:"",e:"",c:[e,f,c,d,a.CNM],k:{literal:b},r:0};return{dM:{k:{keyword:"if then else fi for break continue while in do done echo exit return set declare",literal:b},c:[{cN:"shebang",b:"(#!\\/bin\\/bash)|(#!\\/bin\\/sh)",r:10},c,d,a.HCM,a.CNM,e,f,a.inherit(g,{b:"\\[ ",e:" \\]",r:0}),a.inherit(g,{b:"\\[\\[ ",e:" \\]\\]"})]}}}(c),c.LANGUAGES.cs=function(a){return{dM:{k:"abstract as base bool break byte case catch char checked class const continue decimal default delegate do double else enum event explicit extern false finally fixed float for foreach goto if implicit in int interface internal is lock long namespace new null object operator out override params private protected public readonly ref return sbyte sealed short sizeof stackalloc static string struct switch this throw true try typeof uint ulong unchecked unsafe ushort using virtual volatile void while ascending descending from get group into join let orderby partial select set value var where yield",c:[{cN:"comment",b:"///",e:"$",rB:!0,c:[{cN:"xmlDocTag",b:"///|<!--|-->"},{cN:"xmlDocTag",b:"</?",e:">"}]},a.CLCM,a.CBLCLM,{cN:"preprocessor",b:"#",e:"$",k:"if else elif endif define undef warning error line region endregion pragma checksum"},{cN:"string",b:'@"',e:'"',c:[{b:'""'}]},a.ASM,a.QSM,a.CNM]}}}(c),c.LANGUAGES.ruby=function(a){var b="[a-zA-Z_][a-zA-Z0-9_]*(\\!|\\?)?",c="[a-zA-Z_]\\w*[!?=]?|[-+~]\\@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?",d={keyword:"and false then defined module in return redo if BEGIN retry end for true self when next until do begin unless END rescue nil else break undef not super class case require yield alias while ensure elsif or def",keymethods:"__id__ __send__ abort abs all? allocate ancestors any? arity assoc at at_exit autoload autoload? between? binding binmode block_given? call callcc caller capitalize capitalize! casecmp catch ceil center chomp chomp! chop chop! chr class class_eval class_variable_defined? class_variables clear clone close close_read close_write closed? coerce collect collect! compact compact! concat const_defined? const_get const_missing const_set constants count crypt default default_proc delete delete! delete_at delete_if detect display div divmod downcase downcase! downto dump dup each each_byte each_index each_key each_line each_pair each_value each_with_index empty? entries eof eof? eql? equal? eval exec exit exit! extend fail fcntl fetch fileno fill find find_all first flatten flatten! floor flush for_fd foreach fork format freeze frozen? fsync getc gets global_variables grep gsub gsub! has_key? has_value? hash hex id include include? included_modules index indexes indices induced_from inject insert inspect instance_eval instance_method instance_methods instance_of? instance_variable_defined? instance_variable_get instance_variable_set instance_variables integer? intern invert ioctl is_a? isatty iterator? join key? keys kind_of? lambda last length lineno ljust load local_variables loop lstrip lstrip! map map! match max member? merge merge! method method_defined? method_missing methods min module_eval modulo name nesting new next next! nil? nitems nonzero? object_id oct open pack partition pid pipe pop popen pos prec prec_f prec_i print printf private_class_method private_instance_methods private_method_defined? private_methods proc protected_instance_methods protected_method_defined? protected_methods public_class_method public_instance_methods public_method_defined? public_methods push putc puts quo raise rand rassoc read read_nonblock readchar readline readlines readpartial rehash reject reject! remainder reopen replace require respond_to? reverse reverse! reverse_each rewind rindex rjust round rstrip rstrip! scan seek select send set_trace_func shift singleton_method_added singleton_methods size sleep slice slice! sort sort! sort_by split sprintf squeeze squeeze! srand stat step store strip strip! sub sub! succ succ! sum superclass swapcase swapcase! sync syscall sysopen sysread sysseek system syswrite taint tainted? tell test throw times to_a to_ary to_f to_hash to_i to_int to_io to_proc to_s to_str to_sym tr tr! tr_s tr_s! trace_var transpose trap truncate tty? type ungetc uniq uniq! unpack unshift untaint untrace_var upcase upcase! update upto value? values values_at warn write write_nonblock zero? zip"},e={cN:"yardoctag",b:"@[A-Za-z]+"},f=[{cN:"comment",b:"#",e:"$",c:[e]},{cN:"comment",b:"^\\=begin",e:"^\\=end",c:[e],r:10},{cN:"comment",b:"^__END__",e:"\\n$"}],g={cN:"subst",b:"#\\{",e:"}",l:b,k:d},h=[a.BE,g],i=[{cN:"string",b:"'",e:"'",c:h,r:0},{cN:"string",b:'"',e:'"',c:h,r:0},{cN:"string",b:"%[qw]?\\(",e:"\\)",c:h},{cN:"string",b:"%[qw]?\\[",e:"\\]",c:h},{cN:"string",b:"%[qw]?{",e:"}",c:h},{cN:"string",b:"%[qw]?<",e:">",c:h,r:10},{cN:"string",b:"%[qw]?/",e:"/",c:h,r:10},{cN:"string",b:"%[qw]?%",e:"%",c:h,r:10},{cN:"string",b:"%[qw]?-",e:"-",c:h,r:10},{cN:"string",b:"%[qw]?\\|",e:"\\|",c:h,r:10}],j={cN:"function",b:"\\bdef\\s+",e:" |$|;",l:b,k:d,c:[{cN:"title",b:c,l:b,k:d},{cN:"params",b:"\\(",e:"\\)",l:b,k:d}].concat(f)},k={cN:"identifier",b:b,l:b,k:d,r:0},l=f.concat(i.concat([{cN:"class",bWK:!0,e:"$|;",k:"class module",c:[{cN:"title",b:"[A-Za-z_]\\w*(::\\w+)*(\\?|\\!)?",r:0},{cN:"inheritance",b:"<\\s*",c:[{cN:"parent",b:"("+a.IR+"::)?"+a.IR}]}].concat(f)},j,{cN:"constant",b:"(::)?([A-Z]\\w*(::)?)+",r:0},{cN:"symbol",b:":",c:i.concat([k]),r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{cN:"number",b:"\\?\\w"},{cN:"variable",b:"(\\$\\W)|((\\$|\\@\\@?)(\\w+))"},k,{b:"("+a.RSR+")\\s*",c:f.concat([{cN:"regexp",b:"/",e:"/[a-z]*",i:"\\n",c:[a.BE]}]),r:0}]));return g.c=l,j.c[1].c=l,{dM:{l:b,k:d,c:l}}}(c),c.LANGUAGES.diff=function(){return{cI:!0,dM:{c:[{cN:"chunk",b:"^\\@\\@ +\\-\\d+,\\d+ +\\+\\d+,\\d+ +\\@\\@$",r:10},{cN:"chunk",b:"^\\*\\*\\* +\\d+,\\d+ +\\*\\*\\*\\*$",r:10},{cN:"chunk",b:"^\\-\\-\\- +\\d+,\\d+ +\\-\\-\\-\\-$",r:10},{cN:"header",b:"Index: ",e:"$"},{cN:"header",b:"=====",e:"=====$"},{cN:"header",b:"^\\-\\-\\-",e:"$"},{cN:"header",b:"^\\*{3} ",e:"$"},{cN:"header",b:"^\\+\\+\\+",e:"$"},{cN:"header",b:"\\*{5}",e:"\\*{5}$"},{cN:"addition",b:"^\\+",e:"$"},{cN:"deletion",b:"^\\-",e:"$"},{cN:"change",b:"^\\!",e:"$"}]}}}(c),c.LANGUAGES.javascript=function(a){return{dM:{k:{keyword:"in if for while finally var new function do return void else break catch instanceof with throw case default try this switch continue typeof delete",literal:"true false null undefined NaN Infinity"},c:[a.ASM,a.QSM,a.CLCM,a.CBLCLM,a.CNM,{b:"("+a.RSR+"|\\b(case|return|throw)\\b)\\s*",k:"return throw case",c:[a.CLCM,a.CBLCLM,{cN:"regexp",b:"/",e:"/[gim]*",c:[{b:"\\\\/"}]}],r:0},{cN:"function",bWK:!0,e:"{",k:"function",c:[{cN:"title",b:"[A-Za-z$_][0-9A-Za-z$_]*"},{cN:"params",b:"\\(",e:"\\)",c:[a.CLCM,a.CBLCLM],i:"[\"'\\(]"}],i:"\\[|%"}]}}}(c),c.LANGUAGES.css=function(a){var b={cN:"function",b:a.IR+"\\(",e:"\\)",c:[{eW:!0,eE:!0,c:[a.NM,a.ASM,a.QSM]}]};return{cI:!0,dM:{i:"[=/|']",c:[a.CBLCLM,{cN:"id",b:"\\#[A-Za-z0-9_-]+"},{cN:"class",b:"\\.[A-Za-z0-9_-]+",r:0},{cN:"attr_selector",b:"\\[",e:"\\]",i:"$"},{cN:"pseudo",b:":(:)?[a-zA-Z0-9\\_\\-\\+\\(\\)\\\"\\']+"},{cN:"at_rule",b:"@(font-face|page)",l:"[a-z-]+",k:"font-face page"},{cN:"at_rule",b:"@",e:"[{;]",eE:!0,k:"import page media charset",c:[b,a.ASM,a.QSM,a.NM]},{cN:"tag",b:a.IR,r:0},{cN:"rules",b:"{",e:"}",i:"[^\\s]",r:0,c:[a.CBLCLM,{cN:"rule",b:"[^\\s]",rB:!0,e:";",eW:!0,c:[{cN:"attribute",b:"[A-Z\\_\\.\\-]+",e:":",eE:!0,i:"[^\\s]",starts:{cN:"value",eW:!0,eE:!0,c:[b,a.NM,a.QSM,a.ASM,a.CBLCLM,{cN:"hexcolor",b:"\\#[0-9A-F]+"},{cN:"important",b:"!important"}]}}]}]}]}}}(c),c.LANGUAGES.xml=function(){var b="[A-Za-z0-9\\._:-]+",c={eW:!0,c:[{cN:"attribute",b:b,r:0},{b:'="',rB:!0,e:'"',c:[{cN:"value",b:'"',eW:!0}]},{b:"='",rB:!0,e:"'",c:[{cN:"value",b:"'",eW:!0}]},{b:"=",c:[{cN:"value",b:"[^\\s/>]+"}]}]};return{cI:!0,dM:{c:[{cN:"pi",b:"<\\?",e:"\\?>",r:10},{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},{cN:"comment",b:"<!--",e:"-->",r:10},{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style(?=\\s|>|$)",e:">",k:{title:"style"},c:[c],starts:{e:"</style>",rE:!0,sL:"css"}},{cN:"tag",b:"<script(?=\\s|>|$)",e:">",k:{title:"script"},c:[c],starts:{e:"</script>",rE:!0,sL:"javascript"}},{b:"<%",e:"%>",sL:"vbscript"},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:"[^ />]+"},c]}]}}
}(c),c.LANGUAGES.http=function(){return{dM:{i:"\\S",c:[{cN:"status",b:"^HTTP/[0-9\\.]+",e:"$",c:[{cN:"number",b:"\\b\\d{3}\\b"}]},{cN:"request",b:"^[A-Z]+ (.*?) HTTP/[0-9\\.]+$",rB:!0,e:"$",c:[{cN:"string",b:" ",e:" ",eB:!0,eE:!0}]},{cN:"attribute",b:"^\\w",e:": ",eE:!0,i:"\\n",starts:{cN:"string",e:"$"}},{b:"\\n\\n",starts:{sL:"",eW:!0}}]}}}(c),c.LANGUAGES.java=function(a){return{dM:{k:"false synchronized int abstract float private char boolean static null if const for true while long throw strictfp finally protected import native final return void enum else break transient new catch instanceof byte super volatile case assert short package default double public try this switch continue throws",c:[{cN:"javadoc",b:"/\\*\\*",e:"\\*/",c:[{cN:"javadoctag",b:"@[A-Za-z]+"}],r:10},a.CLCM,a.CBLCLM,a.ASM,a.QSM,{cN:"class",bWK:!0,e:"{",k:"class interface",i:":",c:[{bWK:!0,k:"extends implements",r:10},{cN:"title",b:a.UIR}]},a.CNM,{cN:"annotation",b:"@[A-Za-z]+"}]}}}(c),c.LANGUAGES.php=function(a){var b={cN:"variable",b:"\\$+[a-zA-Z_-\xff][a-zA-Z0-9_-\xff]*"},c=[a.inherit(a.ASM,{i:null}),a.inherit(a.QSM,{i:null}),{cN:"string",b:'b"',e:'"',c:[a.BE]},{cN:"string",b:"b'",e:"'",c:[a.BE]}],d=[a.CNM,a.BNM],e={cN:"title",b:a.UIR};return{cI:!0,dM:{k:"and include_once list abstract global private echo interface as static endswitch array null if endwhile or const for endforeach self var while isset public protected exit foreach throw elseif include __FILE__ empty require_once do xor return implements parent clone use __CLASS__ __LINE__ else break print eval new catch __METHOD__ case exception php_user_filter default die require __FUNCTION__ enddeclare final try this switch continue endfor endif declare unset true false namespace trait goto instanceof insteadof __DIR__ __NAMESPACE__ __halt_compiler",c:[a.CLCM,a.HCM,{cN:"comment",b:"/\\*",e:"\\*/",c:[{cN:"phpdoc",b:"\\s@[A-Za-z]+"}]},{cN:"comment",eB:!0,b:"__halt_compiler.+?;",eW:!0},{cN:"string",b:"<<<['\"]?\\w+['\"]?$",e:"^\\w+;",c:[a.BE]},{cN:"preprocessor",b:"<\\?php",r:10},{cN:"preprocessor",b:"\\?>"},b,{cN:"function",bWK:!0,e:"{",k:"function",i:"\\$|\\[|%",c:[e,{cN:"params",b:"\\(",e:"\\)",c:["self",b,a.CBLCLM].concat(c).concat(d)}]},{cN:"class",bWK:!0,e:"{",k:"class",i:"[:\\(\\$]",c:[{bWK:!0,eW:!0,k:"extends",c:[e]},e]},{b:"=>"}].concat(c).concat(d)}}}(c),c.LANGUAGES.python=function(a){var b=[{cN:"string",b:"(u|b)?r?'''",e:"'''",r:10},{cN:"string",b:'(u|b)?r?"""',e:'"""',r:10},{cN:"string",b:"(u|r|ur)'",e:"'",c:[a.BE],r:10},{cN:"string",b:'(u|r|ur)"',e:'"',c:[a.BE],r:10},{cN:"string",b:"(b|br)'",e:"'",c:[a.BE]},{cN:"string",b:'(b|br)"',e:'"',c:[a.BE]}].concat([a.ASM,a.QSM]),c={cN:"title",b:a.UIR},d={cN:"params",b:"\\(",e:"\\)",c:["self",a.CNM].concat(b)},e={bWK:!0,e:":",i:"[${=;\\n]",c:[c,d],r:10};return{dM:{k:{keyword:"and elif is global as in if from raise for except finally print import pass return exec else break not with class assert yield try while continue del or def lambda nonlocal|10",built_in:"None True False Ellipsis NotImplemented"},i:"(</|->|\\?)",c:b.concat([a.HCM,a.inherit(e,{cN:"function",k:"def"}),a.inherit(e,{cN:"class",k:"class"}),a.CNM,{cN:"decorator",b:"@",e:"$"},{b:"\\b(print|exec)\\("}])}}}(c),c.LANGUAGES.sql=function(a){return{cI:!0,dM:{i:"[^\\s]",c:[{cN:"operator",b:"(begin|start|commit|rollback|savepoint|lock|alter|create|drop|rename|call|delete|do|handler|insert|load|replace|select|truncate|update|set|show|pragma|grant)\\b",e:";",eW:!0,k:{keyword:"all partial global month current_timestamp using go revoke smallint indicator end-exec disconnect zone with character assertion to add current_user usage input local alter match collate real then rollback get read timestamp session_user not integer bit unique day minute desc insert execute like ilike|2 level decimal drop continue isolation found where constraints domain right national some module transaction relative second connect escape close system_user for deferred section cast current sqlstate allocate intersect deallocate numeric public preserve full goto initially asc no key output collation group by union session both last language constraint column of space foreign deferrable prior connection unknown action commit view or first into float year primary cascaded except restrict set references names table outer open select size are rows from prepare distinct leading create only next inner authorization schema corresponding option declare precision immediate else timezone_minute external varying translation true case exception join hour default double scroll value cursor descriptor values dec fetch procedure delete and false int is describe char as at in varchar null trailing any absolute current_time end grant privileges when cross check write current_date pad begin temporary exec time update catalog user sql date on identity timezone_hour natural whenever interval work order cascade diagnostics nchar having left call do handler load replace truncate start lock show pragma",aggregate:"count sum min max avg"},c:[{cN:"string",b:"'",e:"'",c:[a.BE,{b:"''"}],r:0},{cN:"string",b:'"',e:'"',c:[a.BE,{b:'""'}],r:0},{cN:"string",b:"`",e:"`",c:[a.BE]},a.CNM]},a.CBLCLM,{cN:"comment",b:"--",e:"$"}]}}}(c),c.LANGUAGES.ini=function(a){return{cI:!0,dM:{i:"[^\\s]",c:[{cN:"comment",b:";",e:"$"},{cN:"title",b:"^\\[",e:"\\]"},{cN:"setting",b:"^[a-z0-9_\\[\\]]+[ \\t]*=[ \\t]*",e:"$",c:[{cN:"value",eW:!0,k:"on off true false yes no",c:[a.QSM,a.NM]}]}]}}}(c),c.LANGUAGES.perl=function(a){var b="getpwent getservent quotemeta msgrcv scalar kill dbmclose undef lc ma syswrite tr send umask sysopen shmwrite vec qx utime local oct semctl localtime readpipe do return format read sprintf dbmopen pop getpgrp not getpwnam rewinddir qqfileno qw endprotoent wait sethostent bless s|0 opendir continue each sleep endgrent shutdown dump chomp connect getsockname die socketpair close flock exists index shmgetsub for endpwent redo lstat msgctl setpgrp abs exit select print ref gethostbyaddr unshift fcntl syscall goto getnetbyaddr join gmtime symlink semget splice x|0 getpeername recv log setsockopt cos last reverse gethostbyname getgrnam study formline endhostent times chop length gethostent getnetent pack getprotoent getservbyname rand mkdir pos chmod y|0 substr endnetent printf next open msgsnd readdir use unlink getsockopt getpriority rindex wantarray hex system getservbyport endservent int chr untie rmdir prototype tell listen fork shmread ucfirst setprotoent else sysseek link getgrgid shmctl waitpid unpack getnetbyname reset chdir grep split require caller lcfirst until warn while values shift telldir getpwuid my getprotobynumber delete and sort uc defined srand accept package seekdir getprotobyname semop our rename seek if q|0 chroot sysread setpwent no crypt getc chown sqrt write setnetent setpriority foreach tie sin msgget map stat getlogin unless elsif truncate exec keys glob tied closedirioctl socket readlink eval xor readline binmode setservent eof ord bind alarm pipe atan2 getgrent exp time push setgrent gt lt or ne m|0",c={cN:"subst",b:"[$@]\\{",e:"\\}",k:b,r:10},d={cN:"variable",b:"\\$\\d"},e={cN:"variable",b:"[\\$\\%\\@\\*](\\^\\w\\b|#\\w+(\\:\\:\\w+)*|[^\\s\\w{]|{\\w+}|\\w+(\\:\\:\\w*)*)"},f=[a.BE,c,d,e],g={b:"->",c:[{b:a.IR},{b:"{",e:"}"}]},h={cN:"comment",b:"^(__END__|__DATA__)",e:"\\n$",r:5},i=[d,e,a.HCM,h,{cN:"comment",b:"^\\=\\w",e:"\\=cut",eW:!0},g,{cN:"string",b:"q[qwxr]?\\s*\\(",e:"\\)",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\[",e:"\\]",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\{",e:"\\}",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\|",e:"\\|",c:f,r:5},{cN:"string",b:"q[qwxr]?\\s*\\<",e:"\\>",c:f,r:5},{cN:"string",b:"qw\\s+q",e:"q",c:f,r:5},{cN:"string",b:"'",e:"'",c:[a.BE],r:0},{cN:"string",b:'"',e:'"',c:f,r:0},{cN:"string",b:"`",e:"`",c:[a.BE]},{cN:"string",b:"{\\w+}",r:0},{cN:"string",b:"-?\\w+\\s*\\=\\>",r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{b:"("+a.RSR+"|\\b(split|return|print|reverse|grep)\\b)\\s*",k:"split return print reverse grep",r:0,c:[a.HCM,h,{cN:"regexp",b:"(s|tr|y)/(\\\\.|[^/])*/(\\\\.|[^/])*/[a-z]*",r:10},{cN:"regexp",b:"(m|qr)?/",e:"/[a-z]*",c:[a.BE],r:0}]},{cN:"sub",bWK:!0,e:"(\\s*\\(.*?\\))?[;{]",k:"sub",r:5},{cN:"operator",b:"-\\w\\b",r:0}];return c.c=i,g.c[1].c=i,{dM:{k:b,c:i}}}(c),c.LANGUAGES.json=function(a){var b={literal:"true false null"},c=[a.QSM,a.CNM],d={cN:"value",e:",",eW:!0,eE:!0,c:c,k:b},e={b:"{",e:"}",c:[{cN:"attribute",b:'\\s*"',e:'"\\s*:\\s*',eB:!0,eE:!0,c:[a.BE],i:"\\n",starts:d}],i:"\\S"},f={b:"\\[",e:"\\]",c:[a.inherit(d,{cN:null})],i:"\\S"};return c.splice(c.length,0,e,f),{dM:{c:c,k:b,i:"\\S"}}}(c),c.LANGUAGES.cpp=function(a){var b={keyword:"false int float while private char catch export virtual operator sizeof dynamic_cast|10 typedef const_cast|10 const struct for static_cast|10 union namespace unsigned long throw volatile static protected bool template mutable if public friend do return goto auto void enum else break new extern using true class asm case typeid short reinterpret_cast|10 default double register explicit signed typename try this switch continue wchar_t inline delete alignof char16_t char32_t constexpr decltype noexcept nullptr static_assert thread_local restrict _Bool complex",built_in:"std string cin cout cerr clog stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap array shared_ptr"};return{dM:{k:b,i:"</",c:[a.CLCM,a.CBLCLM,a.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},a.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:b,r:10,c:["self"]}]}}}(c),window.hljs=c,b.resolve()}),Komento.module("admin.language",function(){var b=this;Komento.require().language("COM_KOMENTO_CONFIRM_DELETE_AFFECT_ALL_CHILD","COM_KOMENTO_CONFIRM_DELETE","COM_KOMENTO_DELETE_COMMENT","COM_KOMENTO_DELETE_ALL_CHILD","COM_KOMENTO_DELETE_MOVE_CHILD_UP","COM_KOMENTO_DELETING","COM_KOMENTO_CONFIRM_PUBLISH_AFFECT_ALL_CHILD","COM_KOMENTO_PUBLISH_ALL_CHILD","COM_KOMENTO_PUBLISH_SINGLE","COM_KOMENTO_CHILD_UNPUBLISHED","COM_KOMENTO_PARENT_PUBLISHED","COM_KOMENTO_MIGRATORS_LOG_COMPLETE","COM_KOMENTO_MIGRATORS_PROGRESS_DONE","COM_KOMENTO_YES_OPTION","COM_KOMENTO_NO_OPTION","COM_KOMENTO_ACL_RECOMMENDED","COM_KOMENTO_PUBLISH_ITEM","COM_KOMENTO_UNPUBLISH_ITEM").done(function(){b.resolve()})}),Komento.module("admin.database",function(){var b=this;Komento.require().language("COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_UPDATING","COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_COMPLETED","COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_ERROR","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_UPDATING_STAGE1","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_UPDATING_STAGE2","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_ERROR","COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_COMPLETED").done(function(a){Komento.Controller("Database.DepthMaintenance",{defaultOptions:{"{start}":".start","{status}":".status","{total}":".total","{count}":".count","{statusWrapper}":".statusWrapper","{totalWrapper}":".totalWrapper","{countWrapper}":".countWrapper"}},function(b){return{init:function(){},"{start} click":function(c){c.enabled()&&(b.counter=0,c.disabled(!0),b.statusWrapper().show(),b.totalWrapper().show(),b.countWrapper().show(),b.status().html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_UPDATING")),b.totalArticle(0),b.countArticle(0),Komento.ajax("admin.views.system.getArticleStatistics").done(function(a){b.totalArticle(a.length),b.articles=a,b.populateDepth()}).fail(function(){b.status().html(a.language("COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_ERROR"))}))},populateDepth:function(){var c=b.articles[b.counter];return void 0===c?(b.populateComplete(),void 0):(Komento.ajax("admin.views.system.populateDepth",{component:c.component,cid:c.cid}).done(function(){b.counter++,b.countArticle(parseInt(b.countArticle())+1),b.populateDepth()}).fail(function(){b.status().html(a.language("COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_ERROR"))}),void 0)},totalArticle:function(a){return void 0===a?b.total().html():b.total().html(a)},countArticle:function(a){return void 0===a?b.count().html():b.count().html(a)},populateComplete:function(){b.status().html(a.language("COM_KOMENTO_SETTINGS_DATABASE_POPULATE_DEPTH_STATUS_COMPLETED")),b.start().enabled(!0)}}}),Komento.Controller("Database.FixStructure",{defaultOptions:{"{component}":".componentSelection","{article}":".articleSelection","{start}":".start","{status}":".status","{total}":".total","{count}":".count","{statusWrapper}":".statusWrapper","{totalWrapper}":".totalWrapper","{countWrapper}":".countWrapper"}},function(b){return{init:function(){},"{component} change":function(c){var d=c.val();b.article().html(b.createOption("all","*")),"all"!==d&&Komento.ajax("admin.views.system.getArticles",{component:d}).done(function(c){a.each(c,function(a,c){b.article().append(b.createOption(c,c))})})},createOption:function(b,c){var d=a("<option></option>");return d.attr("value",b),d.text(c),d},"{start} click":function(c){if(c.enabled()){b.counter=0,c.disabled(!0),b.statusWrapper().show(),b.totalWrapper().show(),b.countWrapper().show(),b.status().html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_UPDATING_STAGE1")),b.totalArticle(0),b.countArticle(0);var d=b.component().val(),e=b.article().val();Komento.ajax("admin.views.system.getArticleStatistics",{component:d,cid:e}).done(function(a){b.totalArticle(a.length),b.articles=a,b.normalizeStructure()}).fail(function(){b.status().html(a.language("COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_ERROR"))})}},normalizeStructure:function(){var c=b.articles[b.counter];return void 0===c?(b.status().html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_UPDATING_STAGE2")),b.countArticle(0),b.counter=0,b.fixStructure(),void 0):(Komento.ajax("admin.views.system.normalizeStructure",{component:c.component,cid:c.cid}).done(function(){b.counter++,b.countArticle(parseInt(b.countArticle())+1),b.normalizeStructure()}),void 0)},fixStructure:function(){var c=b.articles[b.counter];return void 0===c?(b.fixComplete(),void 0):(Komento.ajax("admin.views.system.fixStructure",{component:c.component,cid:c.cid}).done(function(){b.counter++,b.countArticle(parseInt(b.countArticle())+1),b.fixStructure()}).fail(function(){b.status().html(a.language("COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_ERROR"))}),void 0)},totalArticle:function(a){return void 0===a?b.total().html():b.total().html(a)},countArticle:function(a){return void 0===a?b.count().html():b.count().html(a)},fixComplete:function(){b.status().html(a.language("COM_KOMENTO_SETTINGS_DATABASE_FIX_STRUCTURE_STATUS_COMPLETED")),b.start().enabled(!0)}}}),b.resolve()})}),Komento.module("admin.integrations.customsmileys",function(){var b=this;Komento.Controller("CustomSmileys",{defaultOptions:{"{smiley}":"[data-smiley]","{addRow}":"[data-smiley-add-row]","{add}":"[data-smiley-add-button]","{delete}":"[data-smiley-delete-button]"}},function(a){return{init:function(){},"{add} click":function(){var b=a.smiley().eq(0).clone();b.find("input").val(""),a.addRow().before(b)},"{delete} click":function(b){var c=b.parent("[data-smiley]");a.smiley().length>1?c.remove():c.find("input").val("")}}}),b.resolve()}),Komento.module("admin.report.actions",function(a){var b=this;Komento.require().library("dialog").stylesheet("dialog/default").script("komento.common","admin.language").done(function(){var c={};"1.5"==Komento.options.jversion?(c.published="images/tick.png",c.unpublished="images/publish_x.png"):(c.published="templates/bluestork/images/admin/tick.png",c.unpublished="templates/bluestork/images/admin/publish_x.png"),Komento.actions={submit:function(b,c){0!=a(".foundryDialog").length&&a(".foundryDialog").controller().close(),Komento.actions.affectchild=c;var d=new Array,e=new Array;a('input[type="checkbox"]:checked').each(function(c,f){if(""!=f.value){d.push(f.value),e.push(a("#kmt-"+f.value));var g;g="unstick"==b||"stick"==b?"sticked":"published",a("#kmt-"+f.value).find("."+g+"-cell a img").attr("src",Komento.options.spinner)}}),Komento.ajax("admin.views.comments."+b,{ids:d,affectchild:c},{success:function(){var c=[],d=[];a.each(e,function(a,e){Komento.actions[b](e),e.attr("childs")>0&&c.push(1),0!=e.attr("parentid")&&d.push(1)}),("publish"==b&&d.length>0||"publish"!=b&&c.length>0)&&Komento.actions[b+"Dialog"]()},fail:function(){}})},publish:function(b){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.published):b.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),Komento.actions.publishParent(b),Komento.actions.publishChild(b)},publishParent:function(b){if(b.exists()){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.published):b.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),0!=b.attr("parentid")&&Komento.actions.publishParent(a("#kmt-"+b.attr("parentid")))}},publishChild:function(b){if(b.exists()){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish").replace("publish","unpublish");if(b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_UNPUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.published):b.find(".published-cell i").removeClass("icon-unpublish").addClass("icon-publish"),1==Komento.actions.affectchild&b.attr("childs")>0){var e=b.attr("id").split("-")[1];Komento.actions.publishChild(a('.kmt-row[parentid="'+e+'"]'))}}},publishDialog:function(){a.dialog("<p>"+a.language("COM_KOMENTO_PARENT_PUBLISHED")+"</p>")},publishParentDialog:function(){a.dialog("<p>"+a.language("COM_KOMENTO_PARENT_PUBLISHED")+"</p>")},unpublish:function(b){if(b.exists()){var d=b.find(".published-cell a").attr("onclick").replace("unpublish","publish");if(b.find(".published-cell a").attr("onclick",d).attr("title",a.language("COM_KOMENTO_PUBLISH_ITEM")),Komento.options.jversion<"3.0"?b.find(".published-cell a img").attr("src",c.unpublished):b.find(".published-cell i").removeClass("icon-publish").addClass("icon-unpublish"),b.attr("childs")>0){var e=b.attr("id").split("-")[1];Komento.actions.unpublish(a('.kmt-row[parentid="'+e+'"]'))}}},unpublishDialog:function(){a.dialog("<p>"+a.language("COM_KOMENTO_CHILD_UNPUBLISHED")+"</p>")}},Komento.prepare={checkChild:function(){var b=[];return a('input[type="checkbox"]:checked').each(function(c,d){""!=d.value&&a("#kmt-"+d.value).attr("childs")>0&&b.push(1)}),b.length>0?!0:!1},remove:function(){var b,c;Komento.prepare.checkChild()?(b=a.language("COM_KOMENTO_CONFIRM_DELETE_AFFECT_ALL_CHILD"),c='<button onclick="Komento.prepare.removeall()">'+a.language("COM_KOMENTO_DELETE_ALL_CHILD")+"</button>",c+='<button onclick="Komento.prepare.removesingle()">'+a.language("COM_KOMENTO_DELETE_MOVE_CHILD_UP")+"</button>"):(b=a.language("COM_KOMENTO_CONFIRM_DELETE"),c='<button onclick="Komento.prepare.removeall()">'+a.language("COM_KOMENTO_DELETE_COMMENT")+"</button>");var d='<div style="text-align: center;"><p>'+b+"</p>"+c+"</div>";a.dialog(d)},removeall:function(){prepareSubmit("remove",1)},removesingle:function(){prepareSubmit("remove",0)},publish:function(){if(Komento.prepare.checkChild()){var b=a.language("COM_KOMENTO_CONFIRM_PUBLISH_AFFECT_ALL_CHILD"),c='<button onclick="Komento.prepare.publishall()">'+a.language("COM_KOMENTO_PUBLISH_ALL_CHILD")+"</button>";c+='<button onclick="Komento.prepare.publishsingle()">'+a.language("COM_KOMENTO_PUBLISH_SINGLE")+"</button>";var d='<div style="text-align: center;"><p>'+b+"</p>"+c+"</div>";a.dialog(d)}else Komento.actions.submit("publish",1)},publishall:function(){Komento.actions.submit("publish",1)},publishsingle:function(){Komento.actions.submit("publish",0)},unpublish:function(){Komento.actions.submit("unpublish",1)},clear:function(){submitform("clear")}},window.submitbutton=function(a){Komento.prepare[a]()},window.prepareSubmit=function(b,c){0!=a(".foundryDialog").length&&a(".foundryDialog").controller().close(),document.adminForm.affectchild.value=c,submitform(b)},window.listItemTask=function(a,b){var c=document.adminForm,d=c[a];if(d){for(var e=0;!0;e++){var f=c["cb"+e];if(!f)break;f.checked=!1}d.checked=!0,c.boxchecked.value=1,submitbutton(b)}return!1},b.resolve()})}),Komento.module("dashboard.comment.item",function(a){Komento.require().library("dialog").view("dialogs/delete.affectchild","comment/edit.form").done(function(){Komento.Controller("Dashboard.CommentItem",{defaults:{commentId:0,view:{editForm:"comment/edit.form",affectChild:"dialogs/delete.affectchild"}}},function(b){return{init:function(){},unpublishComment:function(){var c=b.options.commentId,d=c.split("-")[1];Komento.ajax("site.views.komento.unpublish",{id:d},{success:function(){b.closeDialog(),b.unpublishChild(b.element.attr("id")),b.statusButton().text(a.language("COM_KOMENTO_UNPUBLISHED")),b.publishButton().show(),b.unpublishButton().hide(),b.statusOptions().hide()},fail:function(){}})},unpublishChild:function(c){var d=a.language("COM_KOMENTO_UNPUBLISHED");a('li[parentid="'+c+'"]').each(function(){a(this).find(".kmt-status").text(d),a(this).find(".kmt-unpublish").hide(),a(this).find(".kmt-publish").show(),b.unpublishChild(a(this).attr("id"))})}}})})}),Komento.module("dashboard.flag.item",function(a){var b=this;Komento.require().library("ui/effect","dialog").stylesheet("dialog/default").language("COM_KOMENTO_UNPUBLISHED").view("dialogs/delete.affectchild","dialogs/unpublish.affectchild","comment/edit.form").done(function(){Komento.Controller("Dashboard.FlagItem",{defaults:{commentId:0,permalink:0,"{commentText}":".kmt-text","{commentInfo}":".kmt-info","{commentStatus}":".kmt-status","{noflagButton}":".kmt-noflag","{spamButton}":".kmt-spam","{offensiveButton}":".kmt-offensive","{offtopicButton}":".kmt-offtopic","{publishButton}":".kmt-publish","{unpublishButton}":".kmt-unpublish","{deleteButton}":".kmt-delete",view:{editForm:"comment/edit.form",deleteDialog:"dialogs/delete.affectchild",unpublishDialog:"dialogs/unpublish.affectchild"}}},function(b){return{init:function(){},closeDialog:function(){a(".foundryDialog").controller().close()},"{noflagButton} click":function(){b.markComment("0")},"{spamButton} click":function(){b.markComment("1")},"{offensiveButton} click":function(){b.markComment("2")},"{offtopicButton} click":function(){b.markComment("3")},"{publishButton} click":function(){b.publishComment()},"{unpublishButton} click":function(){b.showUnpublishDialog()},"{deleteButton} click":function(){b.showDeleteDialog()},markComment:function(a){var c=b.options.commentId,d=c.split("-")[1];Komento.ajax("site.views.komento.mark",{id:d,type:a},{success:function(){b.element.hide("fade",function(){b.element.remove()})},fail:function(){}})},showPublishDialog:function(){},publishComment:function(){var a=b.options.commentId,c=a.split("-")[1];Komento.ajax("site.views.komento.publish",{id:c,affectChild:0},{success:function(){b.element.hide("fade",function(){b.element.remove()})},fail:function(){}})},showUnpublishDialog:function(){a.dialog({content:b.view.unpublishDialog(!0),afterShow:function(){a(".foundryDialog").find(".unpublish-affectChild").click(function(){b.unpublishComment()})}})},unpublishComment:function(){var c=b.options.commentId,d=c.split("-")[1];Komento.ajax("site.views.komento.unpublish",{id:d},{success:function(){b.closeDialog(),b.unpublishChild(b.element.attr("id")),b.commentStatus().text(a.language("COM_KOMENTO_UNPUBLISHED")),b.unpublishButton().parent().hide("drop")},fail:function(){}})},unpublishChild:function(c){a('tr[parentid="'+c+'"]').each(function(){a(this).find(".kmt-unpublish").parent().hide("drop"),a(this).find(".kmt-status").text(a.language("COM_KOMENTO_UNPUBLISHED")),b.unpublishChild(a(this).attr("id"))})},showDeleteDialog:function(){a.dialog({content:b.view.deleteDialog(!0),afterShow:function(){a(".foundryDialog").find(".delete-affectChild").click(function(){b.deleteComment(1)}),a(".foundryDialog").find(".delete-moveChild").click(function(){b.deleteComment(0)})}})},deleteComment:function(a){var c=b.options.commentId,d=c.split("-")[1];Komento.ajax("site.views.komento.deletecomment",{id:d,affectChild:a},{success:function(){b.closeDialog(),a&&b.deleteChild(b.element.attr("id")),b.element.hide("fade",function(){b.element.remove()})},fail:function(){}})},deleteChild:function(c){a('tr[parentid="'+c+'"]').each(function(){b.deleteChild(a(this).attr("id"))}).hide("fade",function(){a(this).remove()})}}}),b.resolve()})}),Komento.module("komento.admincomments",function(){var b=this;Komento.require().library("dialog").done(function(){Komento.Controller("AdminComments",{defaults:{}},function(){return{init:function(){}}}),b.resolve()})}),Komento.module("komento.bbcode",function(a){var b=this;a.getBBcodeSettings=function(){var b={previewParserVar:"data",markupSet:[]};return 1==Komento.options.config.bbcode_bold&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_BOLD"),key:"B",openWith:"[b]",closeWith:"[/b]",className:"kmt-markitup-bold"}),1==Komento.options.config.bbcode_italic&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_ITALIC"),key:"I",openWith:"[i]",closeWith:"[/i]",className:"kmt-markitup-italic"}),1==Komento.options.config.bbcode_underline&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_UNDERLINE"),key:"U",openWith:"[u]",closeWith:"[/u]",className:"kmt-markitup-underline"}),(1==Komento.options.config.bbcode_bold||1==Komento.options.config.bbcode_italic||1==Komento.options.config.bbcode_underline)&&b.markupSet.push({separator:"---------------"}),1==Komento.options.config.bbcode_link&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_LINK"),key:"L",openWith:'[url="[![Link:!:http://]!]"(!( title="[![Title]!]")!)]',closeWith:"[/url]",placeHolder:a.language("COM_KOMENTO_BBCODE_LINK_TEXT"),className:"kmt-markitup-link"}),1==Komento.options.config.bbcode_picture&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_PICTURE"),key:"P",replaceWith:"[img][![Url]!][/img]",className:"kmt-markitup-picture"}),1==Komento.options.config.bbcode_video&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_VIDEO"),replaceWith:function(b){Komento.ajax("site.views.komento.showVideoDialog",{caretPosition:b.caretPosition,element:a(b.textarea).attr("id")},{success:function(b){Komento.require().library("dialog").stylesheet("dialog/default").done(function(){a.dialog({content:b,title:a.language("COM_KOMENTO_INSERT_VIDEO"),width:400,afterShow:function(){a(".foundryDialog").find(".videoUrl").focus()}})})}})},className:"kmt-markitup-video"}),(1==Komento.options.config.bbcode_link||1==Komento.options.config.bbcode_picture)&&b.markupSet.push({separator:"---------------"}),1==Komento.options.config.bbcode_bulletlist&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_BULLETLIST"),openWith:"[list]\n",closeWith:"\n[/list]",className:"kmt-markitup-bullet"}),1==Komento.options.config.bbcode_numericlist&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_NUMERICLIST"),openWith:"[list=[![Starting number]!]]\n",closeWith:"\n[/list]",className:"kmt-markitup-numeric"}),1==Komento.options.config.bbcode_bullet&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_BULLET"),openWith:"[*]",closeWith:"[/*]",className:"kmt-markitup-list"}),(1==Komento.options.config.bbcode_bulletlist||1==Komento.options.config.bbcode_numericlist||1==Komento.options.config.bbcode_bullet)&&b.markupSet.push({separator:"---------------"}),1==Komento.options.config.bbcode_quote&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_QUOTE"),openWith:"[quote]",closeWith:"[/quote]",className:"kmt-markitup-quote"}),1==Komento.options.config.bbcode_code&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_CODE"),openWith:'[code type="xml"]',closeWith:"[/code]",className:"kmt-markitup-code"}),1==Komento.options.config.bbcode_clean&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_CLEAN"),className:"clean",replaceWith:function(a){return a.selection.replace(/\[(.*?)\]/g,"")},className:"kmt-markitup-clean"}),(1==Komento.options.config.bbcode_quote||Komento.options.config.bbcode_code||1==Komento.options.config.bbcode_clean)&&b.markupSet.push({separator:"---------------"}),1==Komento.options.config.bbcode_smile&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_SMILE"),openWith:":)",className:"kmt-markitup-smile"}),1==Komento.options.config.bbcode_happy&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_HAPPY"),openWith:":D",className:"kmt-markitup-happy"}),1==Komento.options.config.bbcode_surprised&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_SURPRISED"),openWith:":o",className:"kmt-markitup-surprised"}),1==Komento.options.config.bbcode_tongue&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_TONGUE"),openWith:":p",className:"kmt-markitup-tongue"}),1==Komento.options.config.bbcode_unhappy&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_UNHAPPY"),openWith:":(",className:"kmt-markitup-unhappy"}),1==Komento.options.config.bbcode_wink&&b.markupSet.push({name:a.language("COM_KOMENTO_BBCODE_WINK"),openWith:";)",className:"kmt-markitup-wink"}),a.isArray(Komento.options.config.smileycode)&&a.each(Komento.options.config.smileycode,function(a,c){b.markupSet.push({name:c,openWith:c,className:"kmt-markitup-custom-"+a})}),b},b.resolve()}),Komento.module("komento.commentform",function(a){var b=this,c=Komento.require(),d=new Array;d.push("komento.common"),d.push("komento.upload"),1==Komento.options.config.enable_bbcode&&d.push("komento.bbcode"),1==Komento.options.config.show_location&&d.push("location"),c.script.apply(c,d).image(Komento.options.spinner).library("dialog","markitup").stylesheet("dialog/default").done(function(){Komento.Controller("CommentForm",{defaults:{"{addCommentButton}":".addCommentButton","{formArea}":".formArea","{commentInput}":"#commentInput","{markItUpButtons}":".markItUpButton a","{submitButton}":".submitButton","{parentId}":'input[name="parent"]',"{formAuthor}":".formAuthor","{usernameInput}":"#register-username","{nameInput}":"#register-name","{emailInput}":"#register-email","{websiteInput}":"#register-website","{registerCheckbox}":"#register-checkbox","{tncCheckbox}":".tncCheckbox","{tncRead}":".tncRead","{subscribeForm}":".subscribeForm","{subscribeCheckbox}":".subscribeCheckbox","{unsubscribeButton}":".unsubscribeButton","{locationForm}":".locationForm","{formAlert}":".formAlert","{recaptchaChallenge}":"#recaptcha_challenge_field","{recaptchaResponse}":"#recaptcha_response_field","{captchaImage}":"#captcha-image","{captchaResponse}":"#captcha-response","{recaptchaResponse}":"#recaptcha_response_field","{captchaId}":"#captcha-id","{captchaReload}":".kmt-captcha-reload","{locationInput}":".locationInput","{locationLatitude}":".locationLatitude","{locationLongitude}":".locationLongitude","{parentLink}":".parentLink","{parentContainer}":".parentContainer","{cancelStaticReplyButton}":".cancelStaticReply","{commentLength}":".commentLength","{commentLengthCount}":".commentLengthCount","{uploaderWrap}":".uploaderWrap","{pageItemId}":".pageItemId"}},function(b){return{init:function(){b.parentid=0,b.commentInput().val(""),1==Komento.options.config.enable_bbcode&&(b.commentInput().markItUp(a.getBBcodeSettings()),a.isArray(Komento.options.config.smileycode)&&a.each(Komento.options.config.smileycode,function(b){var d=".kmt-markitup-custom-"+b+" a",e=Komento.options.config.smileypath[b];
a.cssRule(d,{"background-image":"url('"+e+"') !important"})})),1==Komento.options.config.show_location&&b.locationForm().exists()&&b.locationForm().implement("Komento.Controller.Location.Form.Simple"),1==Komento.options.config.upload_enable&&1==Komento.options.acl.upload_attachment&&b.uploaderWrap().exists()&&(Komento.options.element.commentupload=a(".uploaderWrap").addController("Komento.Controller.UploadForm"),Komento.options.element.commentupload.kmt=Komento.options.element)},"{commentInput} textChange":function(){b.commentLengthCheck(),b.experimentalValidateComment()},"{commentInput} keyup":function(){b.commentLengthCheck(),b.experimentalValidateComment()},"{nameInput} keyup":function(){b.experimentalValidateComment()},"{emailInput} keyup":function(){b.experimentalValidateComment()},"{websiteInput} keyup":function(){b.experimentalValidateComment()},"{subscribeCheckbox} click":function(){b.experimentalValidateComment()},"{tncCheckbox} click":function(){b.experimentalValidateComment()},"{captchaResponse} keyup":function(){b.experimentalValidateComment()},"{recaptchaResponse} keyup":function(){b.experimentalValidateComment()},"{tncRead} click":function(){var b="<p>"+Komento.options.config.tnc_text.replace(/\n/g,"<br />")+"</p>";a.dialog({title:a.language("COM_KOMENTO_FORM_TNC"),customClass:"kmt-dialog",width:500,showOverlay:!1,content:b})},"{submitButton} click":function(a){a.checkClick()&&a.html('<img src="'+Komento.options.spinner+'" />'),b.validateComment()},"{unsubscribeButton} click":function(a){a.checkClick()&&(a.html('<img src="'+Komento.options.spinner+'" />'),b.unsubscribe())},"{captchaReload} click":function(){b.reloadCaptcha()},"{parentLink} mouseover":function(){b.parentContainer().show()},"{parentLink} mouseout":function(){b.parentContainer().hide()},"{cancelStaticReplyButton} click":function(){b.cancelStaticReply()},"{addCommentButton} click":function(){b.loadForm()},loadForm:function(){1==Komento.options.config.form_toggle_button&&(b.addCommentButton().hide(),b.formArea().show(),1==Komento.options.config.enable_upload&&b.kmt.commentupload&&b.kmt.commentupload.plupload.refresh())},hideForm:function(){1==Komento.options.config.form_toggle_button&&(b.addCommentButton().show(),b.formArea().hide())},commentLengthCheck:function(){1==Komento.options.config.antispam_max_length_enable&&b.commentInput().val().length>Komento.options.config.antispam_max_length&&b.commentInput().val(b.commentInput().val().slice(0,Komento.options.config.antispam_max_length)),b.commentLengthCount().text(b.commentInput().val().length)},validateComment:function(){if(b.clearNotification(),0==Komento.options.konfig.enable_js_form_validation)return b.kmt.commentupload?b.kmt.commentupload.startUpload():b.postComment(),void 0;var c=a.trim(b.nameInput().val()),d=a.trim(b.emailInput().val()),e=a.trim(b.websiteInput().val()),f=a.trim(b.commentInput().val()),g=a.trim(b.captchaResponse().val()),h=a.trim(b.recaptchaResponse().val()),i=[];0==f.length?(b.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_COMMENT_REQUIRED")),i.push("1")):1==Komento.options.config.antispam_min_length_enable&&Komento.options.config.antispam_min_length>0&&f.length<Komento.options.config.antispam_min_length&&(b.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_COMMENT_TOO_SHORT")),i.push("1")),(b.captchaResponse().exists()&&0==g.length||b.recaptchaResponse().exists()&&0==h.length)&&(b.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_CAPTCHA_REQUIRED")),i.push("1")),0==c.length&&(2==Komento.options.config.show_name&&2==Komento.options.config.require_name||1==Komento.options.guest&&Komento.options.config.show_name>0&&1==Komento.options.config.require_name)?(0==b.nameInput().siblings("span").length?b.nameInput().after('<span class="help-inline">'+a.language("COM_KOMENTO_FORM_NOTIFICATION_NAME_REQUIRED")+"</span>"):b.nameInput().siblings("span").show(),b.nameInput().parents("li").addClass("error"),i.push("1")):(b.nameInput().siblings("span").hide(),b.nameInput().parents("li").removeClass("error")),b.emailInput().siblings("span").remove(),0==d.length&&(2==Komento.options.config.show_email&&(2==Komento.options.config.require_email||b.subscribeCheckbox().prop("checked"))||1==Komento.options.guest&&Komento.options.config.show_email>0&&(1==Komento.options.config.require_email||b.subscribeCheckbox().prop("checked")))?(b.emailInput().after('<span class="help-inline">'+a.language("COM_KOMENTO_FORM_NOTIFICATION_EMAIL_REQUIRED")+"</span>"),b.emailInput().parents("li").addClass("error"),i.push("1")):d.length>0&&!b.validateEmail(d)?(b.emailInput().after('<span class="help-inline">'+a.language("COM_KOMENTO_FORM_NOTIFICATION_EMAIL_INVALID")+"</span>"),b.emailInput().parents("li").addClass("error"),i.push("1")):b.emailInput().parents("li").removeClass("error"),b.websiteInput().siblings("span").remove(),0==e.length&&(2==Komento.options.config.show_website&&2==Komento.options.config.require_website||1==Komento.options.guest&&Komento.options.config.show_website>0&&1==Komento.options.config.require_website)?(b.websiteInput().after('<span class="help-inline">'+a.language("COM_KOMENTO_FORM_NOTIFICATION_WEBSITE_REQUIRED")+"</span>"),b.websiteInput().parents("li").addClass("error"),i.push("1")):e.length>0&&!b.validateWebsite(e)?(b.websiteInput().after('<span class="help-inline">'+a.language("COM_KOMENTO_FORM_NOTIFICATION_WEBSITE_INVALID")+"</span>"),b.websiteInput().parents("li").addClass("error"),i.push("1")):b.websiteInput().parents("li").removeClass("error"),1==Komento.options.config.show_tnc&&0==b.tncCheckbox().prop("checked")&&(b.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_TNC_REQUIRED")),i.push("1")),(""==b.locationLongitude().val()||""==b.locationLatitude().val()||""==b.locationInput().val())&&b.locationInput().val(""),0==i.length?b.kmt.commentupload?b.kmt.commentupload.startUpload():b.postComment():0==b.parentid?b.submitButton().text(a.language("COM_KOMENTO_FORM_SUBMIT")):b.submitButton().text(a.language("COM_KOMENTO_FORM_REPLY"))},experimentalValidateComment:function(){if(0==Komento.options.konfig.enable_live_form_validation)return b.submitButton().enable(),!0;var c=a.trim(b.nameInput().val()),d=a.trim(b.emailInput().val()),e=a.trim(b.websiteInput().val()),f=a.trim(b.commentInput().val()),g=a.trim(b.captchaResponse().val()),h=a.trim(b.recaptchaResponse().val()),i=[];0==b.commentInput().val().length?i.push("1"):1==Komento.options.config.antispam_min_length_enable&&Komento.options.config.antispam_min_length>0&&f.length<Komento.options.config.antispam_min_comment_length&&i.push("1"),(b.captchaResponse().exists()&&0==g.length||b.recaptchaResponse().exists()&&0==h.length)&&i.push("1"),0==c.length&&(2==Komento.options.config.show_name&&2==Komento.options.config.require_name||1==Komento.options.guest&&Komento.options.config.show_name>0&&Komento.options.config.require_name>0)&&i.push("1"),0==d.length&&(2==Komento.options.config.show_email&&(2==Komento.options.config.require_email||b.subscribeCheckbox().prop("checked"))||1==Komento.options.guest&&Komento.options.config.show_email>0&&(Komento.options.config.require_email>0||b.subscribeCheckbox().prop("checked")))&&i.push("1"),0==e.length&&(2==Komento.options.config.show_website&&2==Komento.options.config.require_website||1==Komento.options.guest&&Komento.options.config.show_website>0&&Komento.options.config.require_website>0)&&i.push("1"),1==Komento.options.config.show_tnc&&0==b.tncCheckbox().prop("checked")&&i.push("1"),0==i.length?b.submitButton().enable():b.submitButton().disable()},validateEmail:function(b){if(1==Komento.options.config.enable_email_regex){var c=Komento.options.config.email_regex;a.isArray(Komento.options.config.email_regex)&&(c=decodeURIComponent(Komento.options.config.email_regex[0]));var d=new RegExp(c);return d.test(b)}return!0},validateWebsite:function(b){if(1==Komento.options.config.enable_website_regex){var c=Komento.options.config.website_regex;a.isArray(Komento.options.config.website_regex)&&(c=decodeURIComponent(Komento.options.config.website_regex[0]));var d=new RegExp(c);return d.test(b)}return!0},postComment:function(){b.submitButton().disable();var c=[];b.kmt.commentupload&&(c=b.kmt.commentupload.options.uploadedId),Komento.ajax("site.views.komento.addcomment",{component:Komento.component,cid:Komento.cid,comment:b.commentInput().val(),parent_id:b.parentid,depth:b.depth,username:b.usernameInput().val(),name:b.nameInput().val(),email:b.emailInput().val(),website:b.websiteInput().val(),subscribe:b.subscribeCheckbox().prop("checked"),register:b.registerCheckbox().prop("checked"),tnc:b.tncCheckbox().prop("checked"),recaptchaChallenge:b.recaptchaChallenge().val(),recaptchaResponse:b.recaptchaResponse().val(),captchaResponse:b.captchaResponse().val(),captchaId:b.captchaId().val(),latitude:b.locationLatitude().val(),longitude:b.locationLongitude().val(),address:b.locationInput().val(),contentLink:Komento.contentLink,attachments:c,pageItemId:b.pageItemId().val()},{success:function(c,d,e){var f=a.buildHTML(d);1==e?(1==Komento.options.acl.read_comment&&b.kmt.commentlist.addComment(c,f),b.successNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_SUBMITTED"))):b.successNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_PENDING")),(0!=b.captchaId().length||0!=a("#recaptcha_table").length)&&b.reloadCaptcha(),0!=b.parentid&&b.kmt.commentlist.cancelReply(),b.commentInput().val(""),b.commentLengthCount().text("0"),b.locationForm().length>0&&b.locationForm().controller().removeLocation(),0==b.parentid?b.submitButton().text(a.language("COM_KOMENTO_FORM_SUBMIT")):b.submitButton().text(a.language("COM_KOMENTO_FORM_REPLY")),b.kmt.commentupload&&(b.kmt.commentupload.options.uploadedId=[])},fail:function(c){b.errorNotification(c),b.submitButton().text(a.language("COM_KOMENTO_ERROR"))},captcha:function(c){1==Komento.options.config.antispam_captcha_type?Recaptcha.reload():(b.captchaImage().attr("src",c.image),b.captchaId().val(c.id),b.captchaResponse().val("")),0==b.parentid?b.submitButton().text(a.language("COM_KOMENTO_FORM_SUBMIT")):b.submitButton().text(a.language("COM_KOMENTO_FORM_REPLY"))},subscribe:function(){b.subscribeForm().text(a.language("COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBED")).addClass("subscribed")},confirmSubscribe:function(){b.subscribeForm().text(a.language("COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBE_CONFIRMATION_REQUIRED")).addClass("subscribed")},subscribeError:function(){b.subscribeForm().text(a.language("COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBE_ERROR"))},notification:function(a){b.notification(a)},error:function(c){b.errorNotification(c.statusText),a.bugReport(c),b.submitButton().text(a.language("COM_KOMENTO_ERROR"))}})},reloadCaptcha:function(){1==Komento.options.config.antispam_captcha_type?void 0!==Recaptcha&&Recaptcha.reload():Komento.ajax("site.views.komento.reloadCaptcha",{component:Komento.component},{success:function(a){b.captchaImage().attr("src",a.image),b.captchaId().val(a.id),b.captchaResponse().val("")}})},staticReply:function(c){var d=c.parentid.split("-")[1];b.parentid=d,b.depth=parseInt(c.depth)+1;var e=a("#"+parentid),f=e.find(".kmt-avatar:not(.parentContainer > .kmt-avatar)").clone(),g=e.find(".kmt-author:not(.parentContainer > .kmt-author)").clone(),h=e.find(".kmt-time:not(.parentContainer > .kmt-time)").clone(),i=e.find(".commentText:not(.parentContainer > .commentText)").clone(),j='<a href="javascript:void(0);" class="cancelStaticReply">x</a>'+a.language("COM_KOMENTO_FORM_IN_REPLY_TO")+'<a href="'+Komento.contentLink+"#"+parentid+'" class="parentLink kmt-parent-link">#'+d+"</a>",k=a('<span class="parentContainer hidden"></span>');k.html("").append(f).append(g).append(h).append(i),b.element.find("h3.kmt-title").html("").append(j).append(k),b.submitButton().text(a.language("COM_KOMENTO_FORM_REPLY")),b.element.scroll()},cancelStaticReply:function(){b.parentid=0,b.depth=0,b.element.find("h3.kmt-title").text(a.language("COM_KOMENTO_FORM_LEAVE_YOUR_COMMENTS"))},reply:function(c){b.loadForm(),b.parentid=c.id,b.depth=parseInt(c.depth)+1,b.element.find("h3.kmt-title").text(a.language("COM_KOMENTO_FORM_REPLY")),b.element.find(".submitButton").text(a.language("COM_KOMENTO_FORM_REPLY")),c.mine.append(b.element).scroll()},cancelReply:function(){b.hideForm(),b.element.find("h3.kmt-title").text(a.language("COM_KOMENTO_FORM_LEAVE_YOUR_COMMENTS")),b.parentid=0,b.depth=0,b.element.find(".submitButton").text(a.language("COM_KOMENTO_FORM_SUBMIT")),0==Komento.options.config.form_position?0==Komento.options.config.tabbed_comments?a(".commentTools").before(b.element):a(".fameList").before(b.element):0==Komento.options.config.tabbed_comments?a(".commentList").after(b.element):a(".fameList").after(b.element)},unsubscribe:function(){Komento.ajax("site.views.komento.unsubscribe",{component:Komento.component,cid:Komento.cid},{success:function(){b.subscribeForm().text(a.language("COM_KOMENTO_FORM_NOTIFICATION_UNSUBSCRIBED")).removeClass("subscribed")},fail:function(){b.subscribeForm().text(a.language("COM_KOMENTO_ERROR"))}})},errorNotification:function(a){b.formAlert().removeClass("success").addClass("error"),b.notification(a)},successNotification:function(a){b.formAlert().removeClass("error").addClass("success");var c=parseInt(Komento.options.config.autohide_form_notification);b.notification(a,c)},notification:function(a,c){b.formAlert().show(),b.formAlert().append("<li>"+a+"</li>"),1==c&&setTimeout(function(){b.closeNotification()},5e3)},closeNotification:function(){b.formAlert().hide()},clearNotification:function(){b.formAlert().html("").removeClass("error").hide()}}}),b.resolve()})}),Komento.module("komento.commentitem",function(a){var b=this;a.fn.itemset=function(b){var c=a(this),d=a(c).parents(".kmt-item").data();if(!d.item){var e={};e.mine=a(c).parents(".kmt-item"),e.commentid=e.mine.attr("id"),e.both=a("."+e.commentid),e.id=e.commentid.split("-")[1],e.parentid=e.mine.attr("parentid"),e.depth=e.mine.attr("depth"),e.childs=e.mine.attr("childs"),e.published=e.mine.attr("published"),e.element={},e.element.mine={},e.element.both={},e.element.mine.commentText=e.mine.find(b["{commentText}"]),e.element.mine.commentInfo=e.mine.find(b["{commentInfo}"]),e.element.mine.commentForm=e.mine.find(b["{commentForm}"]),e.element.mine.stickButton=e.mine.find(b["{stickButton}"]),e.element.mine.replyButton=e.mine.find(b["{replyButton}"]),e.element.mine.reportButton=e.mine.find(b["{reportButton}"]),e.element.mine.likeButton=e.mine.find(b["{likeButton}"]),e.element.mine.likesCounter=e.mine.find(b["{likesCounter}"]),e.element.mine.editButton=e.mine.find(b["{editButton}"]),e.element.mine.saveEditButton=e.mine.find(b["{saveEditButton}"]),e.element.mine.deleteButton=e.mine.find(b["{deleteButton}"]),e.element.mine.publishButton=e.mine.find(b["{publishButton}"]),e.element.mine.unpublishButton=e.mine.find(b["{unpublishButton}"]),e.element.mine.parentLink=e.mine.find(b["{parentLink}"]),e.element.mine.parentContainer=e.mine.find(b["{parentContainer}"]),e.element.mine.attachmentWrap=e.mine.find(b["{attachmentWrap}"]),e.element.mine.attachmentFile=e.mine.find(b["{attachmentFile}"]),e.element.both.commentText=e.both.find(b["{commentText}"]),e.element.both.commentInfo=e.both.find(b["{commentInfo}"]),e.element.both.stickButton=e.both.find(b["{stickButton}"]),e.element.both.replyButton=e.both.find(b["{replyButton}"]),e.element.both.reportButton=e.both.find(b["{reportButton}"]),e.element.both.likeButton=e.both.find(b["{likeButton}"]),e.element.both.likesCounter=e.both.find(b["{likesCounter}"]),e.element.both.parentLink=e.both.find(b["{parentLink}"]),e.element.both.parentContainer=e.both.find(b["{parentContainer}"]),e.element.both.attachmentWrap=e.both.find(b["{attachmentWrap}"]),e.element.both.attachmentFile=e.both.find(b["{attachmentFile}"]),e.mine.data("item",e),d.item=e}return d.item},b.resolve()}),Komento.module("komento.commentlist",function(a){var b=this;Komento.require().library("ui/effect","fancybox","dialog").stylesheet("dialog/default","fancybox/default").image(Komento.options.spinner).script("sharelinks","markitup","komento.common","komento.commentitem","komento.bbcode","komento.language").view("dialogs/delete.single","dialogs/delete.affectchild","dialogs/unpublish.affectchild","comment/item/edit.form","dialogs/delete.attachment").done(function(){Komento.Controller("CommentList",{defaults:{"{commentList}":".kmt-list","{commentItem}":".kmt-item","{noComment}":".kmt-empty-comment","{loadMore}":".loadMore","{commentText}":".commentText","{commentInfo}":".commentInfo","{commentForm}":".commentForm","{deleteButton}":".deleteButton","{editButton}":".editButton","{saveEditButton}":".saveEditButton","{cancelEditButton}":".cancelEditButton","{editForm}":".editForm","{editInput}":".editInput","{replyButton}":".replyButton","{shareBox}":".shareBox","{reportButton}":".reportButton","{statusButton}":".statusButton","{statusOptions}":".statusOptions","{publishButton}":".publishButton","{unpublishButton}":".unpublishButton","{stickButton}":".stickButton","{likeButton}":".likeButton","{likesCounter}":".likesCounter","{parentLink}":".parentLink","{parentContainer}":".parentContainer","{socialButton}":".socialButton","{attachmentWrap}":".attachmentWrap","{attachmentList}":".attachmentList","{attachmentFile}":".attachmentFile","{attachmentDelete}":".attachmentDelete","{attachmentImage}":".attachmentImage","{attachmentImageLink}":".attachmentImageLink",view:{editForm:"comment/item/edit.form",deleteSingle:"dialogs/delete.single",deleteChilds:"dialogs/delete.affectchild",publishDialog:"dialogs/publish.affectchild",unpublishDialog:"dialogs/unpublish.affectchild",deleteAttachment:"dialogs/delete.attachment"}}},function(b){return{init:function(){if(0==b.noComment().length){if(b.generateSharelinks(),1==Komento.options.konfig.enable_ajax_permalink){for(var d,c=document.location.href.split("#"),e=0;e<c.length;e++)if("kmt-"==c[e].substring(0,4)){d=c[e];break}d&&b.finditem(d),1==Komento.options.config.upload_image_fancybox&&b.attachmentImageLink().fancybox({type:"image",helpers:{overlay:1==Komento.options.config.upload_image_overlay?!0:!1}})}1==Komento.options.config.enable_syntax_highlighting&&a.loadSHBrushes()}},generateSharelinks:function(){var c=function(){b.socialButton().each(function(b,c){a(c).sharelinks()})};b.generateShortLinks(c)},generateShortLinks:function(c){var d=function(d){b.socialButton().each(function(b,c){if(!a(c).attr("loaded")){var e=a(c).attr("commentid"),f=d+"#kmt"+e;a(c).attr("url",f),a(c).parents(".kmt-share-balloon").find(".short-url").val(f)}}),c&&c()};Komento.shortenLink?d(Komento.shortenLink):a.shortenlink(Komento.contentLink,d)},finditem:function(c){0==a("#"+c).length?b.loadMore().is(":hidden")||0==b.loadMore().length||b.loadMoreComments(function(){b.finditem(c)}):(a("#"+c).scroll(),a("#"+c).highlight())},"{loadMore} click":function(a){a.checkClick()&&(a.loading(),b.loadMoreComments())},addComment:function(c,d){var f=d.filter("li").attr("id"),g=0;if(0!=b.noComment().length)b.noComment().remove(),b.commentList().append(d),g=1;else if(0==c||0==Komento.options.config.enable_threaded)1==Komento.options.config.load_previous?("oldest"==Komento.sort&&(b.commentList().append(d),g=1),"latest"!=Komento.sort||0!=b.loadMore().length&&!b.loadMore().is(":hidden")||(b.commentList().prepend(d),g=1)):("oldest"!=Komento.sort||0!=b.loadMore().length&&!b.loadMore().is(":hidden")||(b.commentList().append(d),g=1),"latest"==Komento.sort&&(b.commentList().prepend(d),g=1));else if("oldest"==Komento.sort&&("kmt-form"==b.commentList().find("#kmt-"+c).next().attr("id")?(b.commentList().find("#kmt-"+c).next().after(d),g=1):(b.commentList().find("#kmt-"+c).after(d),g=1)),"latest"==Komento.sort){var h=b.commentList().find("#"+d.attr("parentid"));h.attr("id")==="kmt-"+c?"kmt-form"==b.commentList().find("#kmt-"+c).next().attr("id")?b.commentList().find("#kmt-"+c).next().after(d):b.commentList().find("#kmt-"+c).after(d):b.commentList().find("#kmt-"+c).before(d),g=1}if(g){if(Komento.loadedCount++,0!=c&&b.addChildCount(a("#"+f).attr("parentid")),b.generateSharelinks(),1==Komento.options.config.scroll_to_comment){var i=a("#"+f);i.highlight(),i.scroll()}1==Komento.options.config.enable_syntax_highlighting&&a.loadSHBrushes()}b.kmt.tools.addCommentCounter(),Komento.totalCount++},addChildCount:function(c){var d=parseInt(a("."+c).attr("childs"));a("."+c).attr("childs",d+1),a("."+c).exists()&&parseInt(a("li."+c).attr("parentid").split("-")[1])>0&&b.addChildCount(a("."+c).attr("parentid"))},loadMoreComments:function(c){var d,e=parseInt(Komento.options.config.max_comments_per_page);1==Komento.options.config.load_previous?(d=Komento.totalCount-Komento.loadedCount-e,0>d&&(e+=d,d=0)):d=Komento.loadedCount,Komento.ajax("site.views.komento.loadmorecomments",{component:Komento.component,cid:Komento.cid,start:d,limit:e,sort:Komento.sort,contentLink:Komento.contentLink},{success:function(d,f,g){var h=a(d).filter("li");if(1==Komento.options.config.load_previous?b.commentList().prepend(h):b.commentList().append(h),h.highlight(),Komento.loadedCount=f,b.loadMore().removeClass("loading"),1==g){b.loadMore().removeClass("disabled");var i;1==Komento.options.config.load_previous?(i=Komento.totalCount-Komento.loadedCount-e,0>i&&(e+=i,i=0)):i=Komento.loadedCount,b.loadMore().attr("href","#!kmt-start="+i)}else b.loadMore().hide();c&&c()},fail:function(){}})},set:function(a){b.item=a.itemset(b.options)},"{deleteButton} click":function(a,c){c.stopPropagation(),b.set(a),b.showDeleteDialog()},"{editButton} click":function(a,c){c.stopPropagation(),b.set(a),a.checkClick()&&(a.checkSwitch()?b.edit(a):b.cancelEdit(a))},"{saveEditButton} click":function(a,c){c.stopPropagation(),b.set(a),b.saveEdit(a)},"{cancelEditButton} click":function(a,c){c.stopPropagation(),b.set(a),b.cancelEdit(a)},"{replyButton} click":function(a,c){c.stopPropagation(),b.set(a),1==Komento.options.konfig.enable_inline_reply?a.checkSwitch()?b.reply():b.cancelReply():b.kmt.form.staticReply(b.item)},"{reportButton} click":function(a,c){c.stopPropagation(),b.set(a),a.checkClick()&&(a.checkSwitch()?b.reportComment(a):b.cancelreportComment(a))},"{publishButton} click":function(a,c){c.stopPropagation(),b.set(a),b.item.childs>0?b.showPublishDialog(a):b.publishComment(a)},"{unpublishButton} click":function(a,c){c.stopPropagation(),b.set(a),b.item.childs>0?b.showUnpublishDialog(a):b.unpublishComment(a)},"{stickButton} click":function(a,c){c.stopPropagation(),b.set(a),a.checkClick()&&(a.checkSwitch()?b.stick(a):b.unstick(a))},"{likesCounter} click":function(a,c){c.stopPropagation(),b.set(a),b.showLikesDialog(a)},"{likeButton} click":function(a,c){c.stopPropagation(),b.set(a),a.checkClick()&&(a.checkSwitch()?b.like(a):b.unlike(a))},"{parentLink} mouseover":function(c){b.set(c),1==Komento.options.config.enable_threaded?a("#"+b.item.parentid).addClass("kmt-highlight"):(b.item.element.mine.parentContainer.show(),0==b.item.element.mine.parentContainer.attr("loaded")&&(b.item.element.mine.parentContainer.html('<img src="'+Komento.options.spinner+'" />'),b.loadParent()))},"{parentLink} mouseout":function(c){b.set(c),1==Komento.options.config.enable_threaded?a("#"+b.item.parentid).removeClass("kmt-highlight"):b.item.element.mine.parentContainer.hide()},"{parentLink} click":function(c){b.set(c);var d=a("."+b.item.parentid);d.highlight()},"{attachmentDelete} click":function(a,c){c.stopPropagation(),b.set(a),b.showAttachmentDeleteDialog(a)},"{attachmentImage} click":function(){},closeDialog:function(){a(".foundryDialog").length>0&&a(".foundryDialog").controller().close()},edit:function(){var c=b.item.mine.find("#"+b.item.commentid+"-edit");0==c.length?Komento.ajax("site.views.komento.getcommentraw",{id:b.item.id},{success:function(c){b.item.element.mine.editButton.text(a.language("COM_KOMENTO_COMMENT_EDIT_CANCEL")).switchOff().enable();var d=b.view.editForm({commentId:b.item.commentid,commentText:c});b.item.element.mine.commentText.after(d),b.item.element.mine.editForm=a(d),b.item.element.mine.editInput=b.item.element.mine.editForm.find(".editInput"),b.item.mine.data("item",b.item),1==Komento.options.config.enable_bbcode&&b.item.element.mine.editInput.markItUp(a.getBBcodeSettings())},fail:function(){b.item.element.mine.editButton.text(a.language("COM_KOMENTO_ERROR"))}}):(c.show(),b.item.element.mine.editButton.text(a.language("COM_KOMENTO_COMMENT_EDIT_CANCEL")).switchOff().enable())},cancelEdit:function(){b.item.element.mine.editButton.text(a.language("COM_KOMENTO_COMMENT_EDIT")).switchOn().enable(),b.item.element.mine.editForm.hide()},saveEdit:function(){Komento.ajax("site.views.komento.editcomment",{id:b.item.id,edittedComment:b.item.element.mine.editInput.val()},{success:function(c,d,e){b.item.element.both.commentText.html(c),1==Komento.options.config.enable_info&&b.item.element.both.commentInfo.text(a.language("COM_KOMENTO_COMMENT_EDITTED_BY",d,e)).show().css("display",""),1==Komento.options.config.enable_syntax_highlighting&&a.loadSHBrushes(),b.cancelEdit()},fail:function(b){a.dialog({content:b})}})},reply:function(){a(".formAlert").hide().text(""),a(b.options["{replyButton}"]).switchOn().find("span").text(a.language("COM_KOMENTO_COMMENT_REPLY")),b.item.element.mine.replyButton.switchOff().find("span").text(a.language("COM_KOMENTO_COMMENT_REPLY_CANCEL")),b.kmt.form.reply(b.item)},cancelReply:function(){a(b.options["{replyButton}"]).switchOn().find("span").text(a.language("COM_KOMENTO_COMMENT_REPLY")),b.kmt.form&&b.kmt.form.cancelReply()},showDeleteDialog:function(){b.item.childs>0?a.dialog({height:150,content:b.view.deleteChilds(!0,{childs:b.item.childs}),afterShow:function(){a(".foundryDialog").find(".delete-affectChild").click(function(){b.deleteComment(1)}),a(".foundryDialog").find(".delete-moveChild").click(function(){b.deleteComment(0)})}}):a.dialog({height:150,content:b.view.deleteSingle(!0),afterShow:function(){a(".foundryDialog").find(".delete-affectChild").click(function(){b.deleteComment(1)})}})},deleteComment:function(c){a(".foundryDialog").find(".kmt-delete-status").show(),Komento.ajax("site.views.komento.deletecomment",{id:b.item.id,affectChild:c},{success:function(){b.closeDialog(),1==c?b.deleteChild(b.item.commentid):b.moveChildUp(b.item.commentid,b.item.parentid),b.item.both.hide("fade",function(){b.item.both.remove()}),b.kmt.tools.deductCommentCounter()},fail:function(){a(".foundryDialog").find(".kmt-delete-status").text(a.language("COM_KOMENTO_ERROR"))}})},deleteChild:function(c){a('li[parentid="'+c+'"]').each(function(){b.deleteChild(a(this).attr("id"))}).hide("fade",function(){a(this).remove()});var d=a('li[parentid="'+c+'"]').length;b.kmt.tools.deductCommentCounter(d)},moveChildUp:function(c,d){a('li[parentid="'+c+'"]').attr("parentid",d).each(function(){a(this).removeClass("kmt-child-"+a(this).attr("depth")).addClass("kmt-child-"+(a(this).attr("depth")-1)),a(this).attr("depth",a(this).attr("depth")-1),b.moveChildUp(a(this).attr("id"))})},reportComment:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"report",action:"add"},{success:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_COMMENT_REPORTED")).switchOff().enable()},fail:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_ERROR"))}})},cancelreportComment:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"report",action:"remove"},{success:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_COMMENT_REPORT")).switchOn().enable()},fail:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_ERROR"))}})},showUnpublishDialog:function(){a.dialog({height:150,content:b.view.unpublishDialog(!0,{childs:b.item.childs}),afterShow:function(){a(".foundryDialog").find(".unpublish-affectChild").click(function(){b.unpublishComment()})}})},unpublishComment:function(){Komento.ajax("site.views.komento.unpublish",{id:b.item.id},{success:function(){b.closeDialog(),b.unpublishChild(b.item.commentid),b.item.both.hide("fade",function(){b.item.both.remove()}),b.kmt.tools.deductCommentCounter()},fail:function(){}})},unpublishChild:function(c){a('li[parentid="'+c+'"]').each(function(){b.unpublishChild(a(this).attr("id"))}).hide("fade",function(){a(this).remove()});var d=a('li[parentid="'+c+'"]').length;b.kmt.tools.deductCommentCounter(d)},showPublishDialog:function(){},publishComment:function(){},publishChild:function(){},stick:function(){Komento.ajax("site.views.komento.stick",{id:b.item.id},{success:function(){b.item.element.mine.stickButton.text(a.language("COM_KOMENTO_COMMENT_UNSTICK")).switchOff().enable(),b.item.mine.addClass("kmt-sticked"),b.kmt.famelist.stickComment(b.item.mine.clone())},fail:function(){b.item.element.mine.stickButton.text(a.language("COM_KOMENTO_ERROR"))}})},unstick:function(){Komento.ajax("site.views.komento.unstick",{id:b.item.id},{success:function(){b.item.element.both.stickButton.text(a.language("COM_KOMENTO_COMMENT_STICK")).switchOn().enable(),b.item.both.removeClass("kmt-sticked"),b.kmt.famelist.unstickComment(b.item.commentid)},fail:function(){b.stickButton.text(a.language("COM_KOMENTO_ERROR"))}})},like:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"likes",action:"add"},{success:function(){b.item.element.both.likeButton.switchOff().enable().find("span").text(a.language("COM_KOMENTO_COMMENT_UNLIKE"));var c=parseInt(b.item.element.mine.likesCounter.find("span").text())+1;b.item.element.both.likesCounter.find("span").text(c)},fail:function(a){b.item.element.both.likesCounter.find("span").text(a)}})},unlike:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"likes",action:"remove"},{success:function(){b.item.element.both.likeButton.switchOn().enable().find("span").text(a.language("COM_KOMENTO_COMMENT_LIKE"));var c=parseInt(b.item.element.mine.likesCounter.find("span").text())-1;b.item.element.both.likesCounter.find("span").text(c)},fail:function(){b.item.element.both.likesCounter.find("span").text(a.language("COM_KOMENTO_ERROR"))}})},showLikesDialog:function(){Komento.ajax("site.views.komento.getLikedUsers",{id:b.item.id},{success:function(b){a.dialog({title:a.language("COM_KOMENTO_COMMENT_PEOPLE_WHO_LIKED_THIS"),content:b})}})},loadParent:function(){var c=a("#"+b.item.parentid);if(0!=c.length){var d=c.find(".kmt-avatar:not(.parentContainer > .kmt-avatar)").clone(),e=c.find(".kmt-author:not(.parentContainer > .kmt-author)").clone(),f=c.find(".kmt-time:not(.parentContainer > .kmt-time)").clone(),g=c.find(".commentText:not(.parentContainer > .commentText)").clone();b.item.element.both.parentContainer.html("").append(d).append(e).append(f).append(g)}else{var h=b.item.parentid.split("-")[1];Komento.ajax("site.views.komento.getcomment",{id:h},{success:function(a){b.item.element.both.parentContainer.html(a)},fail:function(){}})}b.item.element.both.parentContainer.attr("loaded",1)},showAttachmentDeleteDialog:function(c){var d=a(c).parents(".attachmentFile").attr("attachmentid"),e=a(c).parents(".attachmentFile").attr("attachmentname");a.dialog({content:b.view.deleteAttachment(!0,{attachmentname:e}),afterShow:function(){a(".foundryDialog").find(".delete-attachment").click(function(){b.closeDialog(),b.deleteFile(d)}),a(".foundryDialog").find(".delete-attachment-cancel").click(function(){b.closeDialog()})}})},deleteFile:function(a){var c=b.item.id;Komento.ajax("site.views.komento.deleteAttachment",{id:c,attachmentid:a},{success:function(){b.item.element.both.attachmentFile.filter(".file-"+a).remove(),0==b.item.mine.find(".attachmentFile").length&&b.item.element.both.attachmentWrap.remove()},fail:function(c){c='<p class="error">'+c+"</p>",b.item.element.both.attachmentFile.filter(".file-"+a).append(c)}})}}}),b.resolve()})}),Komento.module("sharelinks",function(a){var b=this;a.sharelinks=function(b,c,d,e){this[c].call(a(b),c,d,e)},a.fn.sharelinks=function(b,c){var e=this;if(!e.attr("loaded")){if(e.attr("loaded",1),!b)var b=e.attr("type");if(!c){var f,g,h;e.attr("url")&&(f=encodeURIComponent(e.attr("url"))),e.attr("title")&&(g=encodeURIComponent(e.attr("title"))),e.attr("content")&&(h=encodeURIComponent(e.attr("content")));
var c={url:f,title:g,content:h}}a(document).ready(function(){var d=function(b,c,d){a.sharelinks.cleanup.call(b),b.bind("click",function(){a.sharelinks.popup.call(b,d,c)})};a.sharelinks[b].call(e,b,c,d)})}},a.sharelinks.facebook=function(a,b,c){var f,g,h,i,d=this,e="http://www.facebook.com/sharer.php?s=100";b.url&&(f=b.url),b.title?(g=b.title,b.content&&(h=b.content)):b.content&&(g="Comments",h=b.content),b.image&&(i=b.image),e+="&p[url]="+f+"&p[title]="+g+"&p[summary]="+h+"&p[images]="+i,c(d,e,a)},a.sharelinks.twitter=function(a,b,c){var f,g,d=this,e="http://twitter.com/intent/tweet";b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="?url="+f+"&text="+g,c(d,e,a)},a.sharelinks.googleplus=function(a,b,c){var f,d=this,e="http://plus.google.com/share";b.url&&(f=b.url),e+="?url="+f,c(d,e,a)},a.sharelinks.linkedin=function(a,b,c){var f,g,h,d=this,e="http://linkedin.com/shareArticle?mini=true";b.url&&(f=b.url),b.title?(g=b.title,b.content&&(h=b.content)):b.content&&(g=b.content),e+="&url="+f+"&title="+g+"&summary="+h,c(d,e,a)},a.sharelinks.pinterest=function(a,b,c){var f,g,d=this,e="http://pinterest.com/pin/create/button/",h=b.image;b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="?media="+h+"&url="+f+"&description="+g,c(d,e,a)},a.sharelinks.tumblr=function(a,b,c){var f,g,h,d=this,e="http://www.tumblr.com/share/link";b.url&&(f=b.url),b.title?(g=b.title,b.content&&(h=b.content)):b.content&&(g=b.content),e+="?url="+f+"&name="+g+"&description="+h,c(d,e,a)},a.sharelinks.digg=function(a,b,c){var f,g,d=this,e="http://digg.com/submit";b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="?url="+f+"&title="+g,c(d,e,a)},a.sharelinks.delicious=function(a,b,c){var f,g,d=this,e="http://delicious.com/post";b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="?url="+f+"&title="+g,c(d,e,a)},a.sharelinks.reddit=function(a,b,c){var f,g,d=this,e="http://reddit.com/submit";b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="?url="+f+"&title="+g,c(d,e,a)},a.sharelinks.stumbleupon=function(a,b,c){var f,g,d=this,e="http://www.stumbleupon.com/submit";b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="?url="+f+"&title="+g,c(d,e,a)},a.sharelinks.indentica=function(a,b,c){var f,g,d=this,e="http://identi.ca/index.php?action=bookmarkpopup";b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="&url="+f+"&title="+g,c(d,e,a)},a.sharelinks.stumpedia=function(a,b,c){var f,d=this,e="http://www.stumpedia.com/submit";b.url&&(f=b.url),e+="?url="+f,c(d,e,a)},a.sharelinks.technorati=function(a,b,c){var d=this,e="http://technorati.com/faves";b.url&&(add=b.url),e+="?add="+url,c(d,e,a)},a.sharelinks.blogmarks=function(a,b,c){var f,g,d=this,e="http://blogmarks.net/my/new.php?mini=1";b.url&&(f=b.url),b.title?g=b.title:b.content&&(g=b.content),e+="&url="+f+"&title="+g,c(d,e,a)},a.sharelinks.dialog=function(b){Komento.require().library("dialog").stylesheet("dialog/default").done(function(){a.dialog(b)})},a.sharelinks.cleanup=function(){var a=this;a.removeAttr("url").removeAttr("type").removeAttr("title").removeAttr("content").removeAttr("image").removeAttr("commentid").attr("loaded",1)},a.sharelinks.popup=function(a,b){var c="menubar=0,resizable=0,scrollbars=0,";c+="width=660,height=320",window.open(b,"",c)},b.resolve()}),Komento.module("markitup",function($){var module=this;$.fn.markItUp=function(settings,extraSettings){var options,ctrlKey,shiftKey,altKey;return ctrlKey=shiftKey=altKey=!1,options={id:"",nameSpace:"",root:"",previewInWindow:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(a,b){miuScript=$(b).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])}),this.each(function(){function localize(a,b){return b?a.replace(/("|')~\//g,"$1"+options.root):a.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor"),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),options.resizeHandle===!0&&$.browser.safari!==!0&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown",function(a){var d,e,b=$$.height(),c=a.clientY;d=function(a){return $$.css("height",Math.max(20,a.clientY+b-c)+"px"),!1},e=function(){return $("html").unbind("mousemove",d).unbind("mouseup",e),!1},$("html").bind("mousemove",d).bind("mouseup",e)}),footer.append(resizeHandle)),$$.keydown(keyPressed).keyup(keyPressed),$$.bind("insertion",function(a,b){b.target!==!1&&get(),textarea===$.markItUp.focused&&markup(b)}),$$.focus(function(){$.markItUp.focused=this})}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu",function(){return!1}).click(function(){return!1}).mousedown(function(){return button.call&&eval(button.call)(),setTimeout(function(){markup(button)},1),!1}).hover(function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})},function(){$("> ul",this).hide()}).appendTo(ul),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(a){return a?(a=a.toString(),a=a.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(a,b){var c=b.split("|!|");return altKey===!0?void 0!==c[1]?c[1]:c[0]:void 0===c[1]?"":c[0]}),a=a.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(a,b){var c=b.split(":!:");return abort===!0?!1:(value=prompt(c[0],c[1]?c[1]:""),null===value&&(abort=!0),value)})):""}function prepare(a){return $.isFunction(a)&&(a=a(hash)),magicMarkups(a)}function build(a){return openWith=prepare(clicked.openWith),placeHolder=prepare(clicked.placeHolder),replaceWith=prepare(clicked.replaceWith),closeWith=prepare(clicked.closeWith),block=""!==replaceWith?openWith+replaceWith+closeWith:""===selection&&""!==placeHolder?openWith+placeHolder+closeWith:openWith+(a||selection)+closeWith,{block:block,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith}}function markup(a){var b,c,d,e;if(hash=clicked=a,get(),$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),ctrlKey===!0&&shiftKey===!0&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),ctrlKey===!0&&shiftKey===!0){for(lines=selection.split(/\r?\n/),c=0,d=lines.length,e=0;d>e;e++)""!==$.trim(lines[e])?($.extend(hash,{line:++c,selection:lines[e]}),lines[e]=build(lines[e]).block):lines[e]="";string={block:lines.join("\n")},start=caretPosition,b=string.block.length+($.browser.opera?d:0)}else ctrlKey===!0?(string=build(selection),start=caretPosition+string.openWith.length,b=string.block.length-string.openWith.length-string.closeWith.length,b-=fixIeBug(string.block)):shiftKey===!0?(string=build(selection),start=caretPosition,b=string.block.length,b-=fixIeBug(string.block)):(string=build(selection),start=caretPosition+string.block.length,b=0,start-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),start=caretPosition+string.openWith.length,b=string.block.length-string.openWith.length-string.closeWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition}),string.block!==selection&&abort===!1?(insert(string.block),set(start,b)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),ctrlKey===!0&&shiftKey===!0&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(a){return $.browser.opera?a.length-a.replace(/\n*/g,"").length:0}function fixIeBug(a){return $.browser.msie?a.length-a.replace(/\r*/g,"").length:0}function insert(a){if(document.selection){var b=document.selection.createRange();b.text=a}else $$.val($$.val().substring(0,caretPosition)+a+$$.val().substring(caretPosition+selection.length,$$.val().length));$$.trigger("textChange",$$.val())}function set(a,b){if(textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&0==b)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",a),range.moveEnd("character",b),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(a,a+b);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(textarea.focus(),scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,$.browser.msie){var a=document.selection.createRange(),b=a.duplicate();for(b.moveToElementText(textarea),caretPosition=-1;b.inRange(a);)b.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=$$.val().substring(caretPosition,textarea.selectionEnd);return selection}function preview(){!previewWindow||previewWindow.closed?options.previewInWindow?previewWindow=window.open("","preview",options.previewInWindow):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):altKey===!0&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview()}function refreshPreview(){renderPreview()}function renderPreview(){return""!==options.previewParserPath?$.ajax({type:"POST",url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(a){writeInPreview(localize(a,1))}}):template||$.ajax({url:options.previewTemplatePath,success:function(a){writeInPreview(localize(a,1).replace(/<!-- content -->/g,$$.val()))}}),!1}function writeInPreview(a){if(previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(b){sp=0}previewWindow.document.open(),previewWindow.document.write(a),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}options.previewInWindow&&previewWindow.focus()}function keyPressed(a){if(shiftKey=a.shiftKey,altKey=a.altKey,ctrlKey=a.altKey&&a.ctrlKey?!1:a.ctrlKey,ctrlKey=!1,"keydown"===a.type){if(ctrlKey===!0&&(li=$("a[accesskey="+String.fromCharCode(a.keyCode)+"]",header).parent("li"),0!==li.length))return ctrlKey=!1,setTimeout(function(){li.triggerHandler("mousedown")},1),!1;if(13===a.keyCode||10===a.keyCode)return ctrlKey===!0?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):shiftKey===!0?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===a.keyCode)return 1==shiftKey||1==ctrlKey||1==altKey?!1:-1!==caretOffset?(get(),caretOffset=$$.val().length-caretOffset,set(caretOffset,0),caretOffset=-1,!1):(markup(options.onTab),options.onTab.keepDefault)}}var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),init()})},$.fn.markItUpRemove=function(){return this.each(function(){var a=$(this).unbind().removeClass("markItUpEditor");a.parent("div").parent("div.markItUp").parent("div").replaceWith(a)})},$.markItUp=function(a){var b={target:!1};return $.extend(b,a),b.target?$(b.target).each(function(){$(this).focus(),$(this).trigger("insertion",[b])}):($("textarea").trigger("insertion",[b]),void 0)},module.resolve()}),Komento.module("komento.commenttools",function(a){var b=this;Komento.require().script("komento.commentlist","komento.common","komento.language").library("dialog").stylesheet("dialog/default").view("notifications/new.comment").done(function(){Komento.Controller("CommentTools",{defaults:{"{commentCounter}":".commentCounter","{sortOldest}":".sortOldest a","{sortLatest}":".sortLatest a","{sortButton}":".kmt-sorting a","{adminButton}":".adminMode a","{subscribeEmail}":".subscribeEmail a","{addYours}":".kmt-addyours",view:{newComment:"notifications/new.comment"}}},function(b){return{init:function(){1==Komento.options.acl.read_comment&&1==Komento.options.konfig.enable_ajax_load_list&&b.loadCommentList(),1==Komento.options.konfig.enable_live_notification&&(b.hasNew=0,b.newCount=0,b.checkNewComment())},loadCommentList:function(){b.reloadComments(Komento.sort)},"{addYours} click":function(){b.kmt.form&&b.kmt.form.loadForm()},"{sortOldest} click":function(a){b.sortButton().checkClick()&&(b.sortButton().removeClass("selected"),a.loading().addClass("selected"),b.reloadComments("oldest"))},"{sortLatest} click":function(a){b.sortButton().checkClick()&&(b.sortButton().removeClass("selected"),a.loading().addClass("selected"),b.reloadComments("latest"))},"{sortLikes} click":function(a){b.sortButton().checkClick()&&(b.sortButton().removeClass("selected"),a.loading().addClass("selected"),b.reloadComments("likes"))},"{adminButton} click":function(){b.reloadComments(Komento.sort,"all")},"{subscribeEmail} click":function(c){a.dialog({content:b.getSubscribeContent(),afterShow:function(){var d=a(".foundryDialog"),e=d.find(".subscribe"),f=d.find(".unsubscribe"),g=d.find(".subscribeName"),h=d.find(".subscribeEmail"),i=d.find(".subscribeUser"),j=d.find(".subscribeError");e.click(function(){if(i.length>0)Komento.ajax("site.views.komento.subscribeuser",{user:i.val(),component:Komento.component,cid:Komento.cid},{success:function(){b.kmt.form&&b.kmt.form.subscribeForm().text(a.language("COM_KOMENTO_FORM_NOTIFICATION_SUBSCRIBED")).addClass("subscribed"),a(".foundryDialog").controller().close()}});else{if(""==g.val()||""==h.val())return j.show(),!1;Komento.ajax("site.views.komento.subscribeguest",{name:g.val(),email:h.val(),component:Komento.component,cid:Komento.cid},{success:function(){a(".foundryDialog").controller().close(),c.remove()}})}}),f.click(function(){Komento.ajax("site.views.komento.unsubscribeuser",{user:i.val(),component:Komento.component,cid:Komento.cid},{success:function(){b.kmt.form&&b.kmt.form.subscribeForm().text(a.language("COM_KOMENTO_FORM_NOTIFICATION_UNSUBSCRIBED")).removeClass("subscribed"),a(".foundryDialog").controller().close()}})})}})},getSubscribeContent:function(){var b=a.Deferred();return Komento.ajax("site.views.komento.getsubscribecontent",{component:Komento.component,cid:Komento.cid},{success:function(a){b.resolve(a)}}),b},reloadComments:function(c,d){b.kmt&&b.kmt.commentlist.cancelReply(),a(".commentList").html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_COMMENTS_LOADING")),Komento.ajax("site.views.komento.reloadcomments",{component:Komento.component,cid:Komento.cid,contentLink:Komento.contentLink,options:{sort:c,published:d}},{success:function(d,e,f){Komento.sort=c,Komento.loadedCount=e,Komento.totalCount=f,b.setCommentCounter(e);var g=a(d);a(".commentList").html(g).controller().init(),b.sortButton().enable().doneLoading(),a(".kmt-notification").remove()},fail:function(){a(".commentList").text(a.language("COM_KOMENTO_ERROR"))}})},checkNewComment:function(){var c=Komento.options.konfig.live_notification_interval?1e3*parseInt(Komento.options.konfig.live_notification_interval):3e4;setTimeout(function(){Komento.ajax("site.views.komento.checknewcomment",{component:Komento.component,cid:Komento.cid,total:Komento.totalCount},{success:function(c,d){if(1==c&&d>b.newCount){a(".kmt-notification").remove();var e=b.view.newComment({count:d});e.find(".reloadComments").bind("click",function(){b.kmt.tools.reloadComments(Komento.sort)}),a("body").append(e)}b.newCount=d,b.hasNew=c},fail:function(){},complete:function(){b.kmt.tools.checkNewComment()}})},c)},addCommentCounter:function(){var a=b.commentCounter().text();b.commentCounter().text(parseInt(a)+1)},deductCommentCounter:function(a){void 0===a&&(a=1);var c=b.commentCounter().text();b.commentCounter().text(parseInt(c)-a),Komento.loadedCount-=a,Komento.totalCount-=a},setCommentCounter:function(a){void 0===a&&(a=0),b.commentCounter().text(a)}}}),b.resolve()})}),Komento.module("komento.famelist",function(a){var b=this;Komento.require().library("ui/effect","dialog").stylesheet("dialog/default").image(Komento.options.spinner).script("sharelinks","markitup","komento.common","komento.commentitem","komento.language").view("dialogs/delete.single","dialogs/delete.affectchild","dialogs/unpublish.affectchild","comment/item/edit.form","dialogs/delete.attachment").done(function(){Komento.Controller("FameList",{defaults:{"{commentList}":".kmt-list","{stickList}":".stickList .kmt-list","{loveList}":".loveList .kmt-list","{commentItem}":".kmt-item","{stickItem}":".stickList .kmt-list .kmt-item","{loveItem}":".loveList .kmt-list .kmt-item","{noComment}":".kmt-empty-comment","{loadMore}":".loadMore","{navs}":".navs","{tabs}":".tabs","{commentText}":".commentText","{commentInfo}":".commentInfo","{commentForm}":".commentForm","{deleteButton}":".deleteButton","{editButton}":".editButton","{saveEditButton}":".saveEditButton","{editForm}":".editForm","{editInput}":".editInput","{replyButton}":".replyButton","{shareBox}":".shareBox","{reportButton}":".reportButton","{statusButton}":".statusButton","{statusOptions}":".statusOptions","{publishButton}":".publishButton","{unpublishButton}":".unpublishButton","{stickButton}":".stickButton","{likeButton}":".likeButton","{likesCounter}":".likesCounter","{parentLink}":".parentLink","{parentContainer}":".parentContainer","{socialButton}":".socialButton",view:{editForm:"comment/item/edit.form",deleteDialog:"dialogs/delete.affectchild",publishDialog:"dialogs/publish.affectchild",unpublishDialog:"dialogs/unpublish.affectchild",deleteAttachment:"dialogs/delete.attachment"}}},function(b){return{init:function(){b.navs().length>0&&b.navs().eq(0).trigger("click")},ajaxinit:function(){b.generateSharelinks()},generateSharelinks:function(){var c=function(){b.socialButton().each(function(b,c){a(c).sharelinks()})};b.generateShortLinks(c)},generateShortLinks:function(c){var d=function(d){b.socialButton().each(function(b,c){if(!a(c).attr("loaded")){var e=a(c).attr("commentid"),f=d+"#kmt"+e;a(c).attr("url",f),a(c).parents(".kmt-share-balloon").find(".short-url").val(f)}}),c&&c()};Komento.shortenLink?d(Komento.shortenLink):a.shortenlink(Komento.contentLink,d)},"{navs} click":function(c){var d=a(c).attr("func"),e=a(c).attr("tab"),f=a("."+e);f.attr("loaded")||(b[d](),("stickList"==e&&"1"!=Komento.options.konfig.enforce_live_stickies||"loveList"==e&&"1"!=Komento.options.konfig.enforce_live_lovies)&&f.attr("loaded",1)),b.tabs().hide(),f.show(),b.navs().removeClass("active"),c.addClass("active")},loadMainList:function(){b.loadComments("main")},loadStickList:function(){1==Komento.options.acl.read_stickies&&1==Komento.options.config.enable_stickies&&1==Komento.options.konfig.enable_ajax_load_stickies&&b.loadComments("stickies")},loadLoveList:function(){1==Komento.options.acl.read_lovies&&1==Komento.options.config.enable_lovies&&1==Komento.options.konfig.enable_ajax_load_lovies&&b.loadComments("lovies")},loadComments:function(c){var d,e,f,g;switch(f=0,c){case"stickies":d=".stickList",e=1,g="default",limit=parseInt(Komento.options.config.max_stickies);break;case"lovies":d=".loveList",e="all",g="love",limit=parseInt(Komento.options.config.max_lovies);break;default:d=".mainList",e="all",g="default",limit=parseInt(Komento.options.config.max_comments_per_page)}a(d).html('<div class="loading"><img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_COMMENTS_LOADING")+"</div>"),Komento.ajax("site.views.komento.loadcomments",{type:c,component:Komento.component,cid:Komento.cid,sticked:e,threaded:f,sort:g,limit:limit,contentLink:Komento.contentLink},{success:function(c){var e=a(c);a(d).html(e),b.ajaxinit()},fail:function(){a(d).text(a.language("COM_KOMENTO_ERROR"))}})},stickComment:function(c){c=a(c),c.children(".kmt-wrap").attr("style","left-margin: 0px !important");var d=c.attr("id").split("-")[1],e=0;0==b.stickItem().length?b.loadStickList():b.stickItem().length<Komento.options.config.max_stickies&&(b.stickItem().each(function(b,f){return a(f).attr("id").split("-")[1]>d?(a(f).before(c),e=1,void 0):void 0}),0==e&&b.stickList().append(a(c)))},unstickComment:function(a){b.stickList().find("#"+a).remove()},set:function(a){b.item=a.itemset(b.options)},"{deleteButton} click":function(a){b.set(a),b.showDeleteDialog()},"{editButton} click":function(a){b.set(a),a.checkClick()&&(a.checkSwitch()?b.edit(a):b.cancelEdit(a))},"{saveEditButton} click":function(a){b.set(a),b.saveEdit(a)},"{replyButton} click":function(a){b.set(a),1==Komento.options.konfig.enable_inline_reply?a.checkSwitch()?b.reply(a):b.cancelReply(a):b.kmt.form.staticReply(b.item.parentid)},"{reportButton} click":function(a){b.set(a),a.checkClick()&&(a.checkSwitch()?b.reportComment(a):b.cancelreportComment(a))},"{unpublishButton} click":function(){b.set(el),b.childs>0?b.showUnpublishDialog(el):b.unpublishComment(el)},"{stickButton} click":function(a){b.set(a),a.checkClick()&&(a.checkSwitch()?b.stick(a):b.unstick(a))},"{likesCounter} click":function(a){b.set(a),b.showLikesDialog()},"{likeButton} click":function(a){b.set(a),a.checkClick()&&(a.checkSwitch()?b.like(a):b.unlike(a))},"{parentLink} mouseover":function(c){b.set(c),1==Komento.options.config.enable_threaded?a("#"+b.item.parentid).addClass("kmt-highlight"):(b.item.element.mine.parentContainer.show(),0==b.item.element.mine.parentContainer.attr("loaded")&&(b.item.element.mine.parentContainer.html('<img src="'+Komento.options.spinner+'" />'),b.loadParent()))},"{parentLink} mouseout":function(c){b.set(c),1==Komento.options.config.enable_threaded?a("#"+b.item.parentid).removeClass("kmt-highlight"):b.item.element.mine.parentContainer.hide()},"{parentLink} click":function(c){b.set(c);var d=a("."+b.item.parentid);d.highlight()},"{attachmentDelete} click":function(a){b.set(a),b.showAttachmentDeleteDialog(a)},closeDialog:function(){a(".foundryDialog").length>0&&a(".foundryDialog").controller().close()},edit:function(){var c=b.item.mine.find("#"+b.item.commentid+"-edit");0==c.length?Komento.ajax("site.views.komento.getcommentraw",{id:b.item.id},{success:function(c){b.item.element.mine.editButton.text(a.language("COM_KOMENTO_COMMENT_EDIT_CANCEL")).switchOff().enable();var d=b.view.editForm({commentId:b.item.commentid,commentText:c});b.item.element.mine.commentText.after(d),b.item.element.mine.editForm=a(d),b.item.element.mine.editInput=b.item.element.mine.editForm.find(".editInput"),b.item.mine.data("item",b.item),1==Komento.options.config.enable_bbcode&&b.item.element.mine.editInput.markItUp(a.getBBcodeSettings())},fail:function(){b.item.element.mine.editButton.text(a.language("COM_KOMENTO_ERROR"))}}):(c.show(),b.item.element.mine.editButton.text(a.language("COM_KOMENTO_COMMENT_EDIT_CANCEL")).switchOff().enable())},cancelEdit:function(){b.item.element.mine.editButton.text(a.language("COM_KOMENTO_COMMENT_EDIT")).switchOn().enable(),b.item.element.mine.editForm.hide()},saveEdit:function(){Komento.ajax("site.views.komento.editcomment",{id:b.item.id,edittedComment:b.item.element.mine.editInput.val()},{success:function(c,d,e){b.item.element.both.commentText.html(c),b.item.element.both.commentInfo.text(a.language("COM_KOMENTO_COMMENT_EDITTED_BY",d,e)).show(),1==Komento.options.config.enable_syntax_highlighting&&a.loadSHBrushes(),b.cancelEdit()},fail:function(){a.dialog({content:message})}})},reply:function(){a(".commentForm");a(".formAlert").hide().text(""),a(b.options["{replyButton}"]).switchOn().find("span").text(a.language("COM_KOMENTO_COMMENT_REPLY")),b.item.element.mine.replyButton.switchOff().find("span").text(a.language("COM_KOMENTO_COMMENT_REPLY_CANCEL")),b.kmt.form.reply(b.item)},cancelReply:function(){a(b.options["{replyButton}"]).switchOn().find("span").text(a.language("COM_KOMENTO_COMMENT_REPLY")),b.kmt.form.cancelReply()},showDeleteDialog:function(){a.dialog({height:150,content:b.view.deleteDialog(!0,{childs:b.childs}),afterShow:function(){a(".foundryDialog").find(".delete-affectChild").click(function(){b.deleteComment(1)}),a(".foundryDialog").find(".delete-moveChild").click(function(){b.deleteComment(0)})}})},deleteComment:function(c){a(".foundryDialog").find(".kmt-delete-status").show(),Komento.ajax("site.views.komento.deletecomment",{id:b.item.id,affectChild:c},{success:function(){b.closeDialog(),c?b.deleteChild(b.item.id):b.moveChildUp(b.item.id,b.item.parentid),b.item.both.hide("fade",function(){b.item.both.remove()})},fail:function(){a(".foundryDialog").find(".kmt-delete-status").text(a.language("COM_KOMENTO_ERROR"))}})},deleteChild:function(c){a('li[parentid="'+c+'"]').each(function(){b.deleteChild(a(this).attr("id"))}).hide("fade",function(){a(this).remove()})},moveChildUp:function(c,d){a('li[parentid="'+c+'"]').attr("parentid",d).each(function(){a(this).removeClass("kmt-child-"+a(this).attr("depth")).addClass("kmt-child-"+(a(this).attr("depth")-1)),a(this).attr("depth",a(this).attr("depth")-1),b.moveChildUp(a(this).attr("id"))})},reportComment:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"report",action:"add"},{success:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_COMMENT_REPORTED")).switchOff().enable()},fail:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_ERROR"))}})},cancelreportComment:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"report",action:"remove"},{success:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_COMMENT_REPORT")).switchOn().enable()},fail:function(){b.item.element.both.reportButton.text(a.language("COM_KOMENTO_ERROR"))}})},showUnpublishDialog:function(){a.dialog({height:150,content:b.view.unpublishDialog(!0,{childs:b.childs}),afterShow:function(){a(".foundryDialog").find(".unpublish-affectChild").click(function(){b.unpublishComment()})}})},unpublishComment:function(){Komento.ajax("site.views.komento.unpublish",{id:b.item.id},{success:function(){b.closeDialog(),b.unpublishChild(b.item.id),b.item.both.hide("fade",function(){b.item.both.remove()})},fail:function(){}})},unpublishChild:function(c){a('li[parentid="'+c+'"]').each(function(){b.unpublishChild(a(this).attr("id"))}).hide("fade",function(){a(this).remove()})},stick:function(){Komento.ajax("site.views.komento.stick",{id:b.item.id},{success:function(){b.item.element.mine.stickButton.text(a.language("COM_KOMENTO_COMMENT_UNSTICK")).switchOff().enable(),b.item.mine.addClass("kmt-sticked"),b.kmt.famelist.stickComment(b.item.mine.clone())},fail:function(){b.item.element.mine.stickButton.text(a.language("COM_KOMENTO_ERROR"))}})},unstick:function(){Komento.ajax("site.views.komento.unstick",{id:b.item.id},{success:function(){b.item.element.both.stickButton.text(a.language("COM_KOMENTO_COMMENT_STICK")).switchOn().enable(),b.item.both.removeClass("kmt-sticked"),b.unstickComment(b.item.commentid)},fail:function(){b.stickButton.text(a.language("COM_KOMENTO_ERROR"))}})},like:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"likes",action:"add"},{success:function(){b.item.element.both.likeButton.switchOff().enable().find("span").text(a.language("COM_KOMENTO_COMMENT_UNLIKE"));var c=parseInt(b.item.element.mine.likesCounter.find("span").text())+1;b.item.element.both.likesCounter.find("span").text(c)},fail:function(a){b.item.element.both.likesCounter.find("span").text(a)}})},unlike:function(){Komento.ajax("site.views.komento.action",{id:b.item.id,type:"likes",action:"remove"},{success:function(){b.item.element.both.likeButton.switchOn().enable().find("span").text(a.language("COM_KOMENTO_COMMENT_LIKE"));var c=parseInt(b.item.element.mine.likesCounter.find("span").text())-1;b.item.element.both.likesCounter.find("span").text(c)},fail:function(){b.item.element.both.likesCounter.find("span").text(a.language("COM_KOMENTO_ERROR"))}})},showLikesDialog:function(){Komento.ajax("site.views.komento.getLikedUsers",{id:b.item.id},{success:function(b){a.dialog({title:a.language("COM_KOMENTO_COMMENT_PEOPLE_WHO_LIKED_THIS"),content:b})}})},loadParent:function(){var c=a("#"+b.item.parentid);if(0!=c.length){var d=c.find(".kmt-avatar:not(.parentContainer > .kmt-avatar)").clone(),e=c.find(".kmt-author:not(.parentContainer > .kmt-author)").clone(),f=c.find(".kmt-time:not(.parentContainer > .kmt-time)").clone(),g=c.find(".commentText:not(.parentContainer > .commentText)").clone();b.item.element.both.parentContainer.html("").append(d).append(e).append(f).append(g)}else{var h=b.item.parentid.split("-")[1];Komento.ajax("site.views.komento.getcomment",{id:h},{success:function(a){b.item.element.both.parentContainer.html(a)},fail:function(){}})}b.item.element.both.parentContainer.attr("loaded",1)},showAttachmentDeleteDialog:function(c){var d=a(c).parents(".attachmentFile").attr("attachmentid"),e=a(c).parents(".attachmentFile").attr("attachmentname");a.dialog({height:150,content:b.view.deleteAttachment(!0,{attachmentname:e}),afterShow:function(){a(".foundryDialog").find(".delete-attachment").click(function(){b.closeDialog(),b.deleteFile(d)}),a(".foundryDialog").find(".delete-attachment-cancel").click(function(){b.closeDialog()})}})},deleteFile:function(a){var c=b.item.id;Komento.ajax("site.views.komento.deleteAttachment",{id:c,attachmentid:a},{success:function(){b.item.element.both.attachmentFile.filter(".file-"+a).remove(),0==b.item.mine.find(".attachmentFile").length&&b.item.element.both.attachmentWrap.remove()},fail:function(c){c='<p class="error">'+c+"</p>",b.item.element.both.attachmentFile.filter(".file-"+a).append(c)}})}}}),b.resolve()})}),Komento.module("komento.insertvideo",function(a){var b=this;Komento.Controller("InsertVideo",{defaults:{caretPosition:"",element:"","{videoUrl}":".videoUrl","{insertVideo}":".insertVideo","{cancelVideo}":".cancelVideo"}},function(b){return{init:function(){},"{insertVideo} click":function(){b.addVideoLink()},"{cancelVideo} click":function(){b.closeDialog()},"{videoUrl} keypress":function(a,c){13==c.keyCode&&(c.preventDefault(),b.addVideoLink())},addVideoLink:function(){var c=b.videoUrl().val();if(""!==c){var d=a("#"+b.options.element),e="[video]"+c+"[/video]",f=d.val();if(0==b.options.caretPosition)return d.val(e+f),a(".commentInput").focus(),a(".commentForm").controller().commentLengthCheck(),b.closeDialog(),!0;var f=d.val();d.val(f.substring(0,b.options.caretPosition)+e+f.substring(b.options.caretPosition,f.length)),a(".commentInput").focus(),a(".commentForm").controller().commentLengthCheck(),b.closeDialog()
}},closeDialog:function(){a(".foundryDialog").controller().close()}}}),b.resolve()}),Komento.ready(function(a){Komento.options.responsive&&a(function(){a("#section-kmt").responsive([{at:600,switchTo:"w600"},{at:400,switchTo:"w600 w320"}])})}),Komento.module("komento.profile",function(a){var b=this;Komento.require().script("komento.common").done(function(){Komento.Controller("Profile",{defaults:{uid:0,"{navComments}":".navComments","{navActivities}":".navActivities","{navPopular}":".navPopular","{navSticked}":".navSticked","{navs}":".navs","{tabs}":".tabs","{commentsTab}":"#kmt-comments","{activitiesTab}":"#kmt-activities","{popularTab}":"#kmt-popular","{stickedTab}":"#kmt-sticked","{loadMore}":".loadMore"}},function(b){return{init:function(){b.navs(":eq(0)").trigger("click"),b.loaded={},b.total={}},"{navs} click":function(c){var d=a(c).attr("func"),e=a(c).attr("tab");b.tabs().hide(),a("#"+e).show(),b.navs().removeClass("active"),c.addClass("active"),b[d]&&b[d]()},"{loadMore} click":function(a){if(a.checkClick()){var c=a.parents(".tabs").attr("id").substring(4),d="loadMore"+c.charAt(0).toUpperCase()+c.slice(1);b[d]()}},loadComments:function(){b.commentsTab().attr("loaded")||(b.commentsTab().html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_LOADING")),Komento.ajax("site.views.profile.getcomments",{uid:b.options.uid},{success:function(a,c,d){b.commentsTab().html(a),b.commentsTab().attr("loaded",!0),b.loaded.comments=parseInt(c),b.total.comments=parseInt(d)},fail:function(){}}))},loadMoreComments:function(){Komento.ajax("site.views.profile.getcomments",{loadMore:1,uid:b.options.uid,start:b.loaded.comments},{success:function(a,c){b.commentsTab().children("ul").append(a),b.loaded.comments+=parseInt(c),b.loaded.comments>=b.total.comments&&b.hideLoadMore("comments"),b.loadMore().enable()},fail:function(){}})},loadActivities:function(){b.activitiesTab().attr("loaded")||(b.activitiesTab().html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_LOADING")),Komento.ajax("site.views.profile.getactivities",{uid:b.options.uid},{success:function(a,c,d){b.activitiesTab().html(a),b.activitiesTab().attr("loaded",!0),b.loaded.activities=parseInt(c),b.total.activities=parseInt(d)},fail:function(){}}))},loadMoreActivities:function(){Komento.ajax("site.views.profile.getactivities",{loadMore:1,uid:b.options.uid,start:b.loaded.activities},{success:function(a,c){b.activitiesTab().children("ul").append(a),b.loaded.activities+=parseInt(c),b.loaded.activities>=b.total.activities&&b.hideLoadMore("activities"),b.loadMore().enable()},fail:function(){}})},loadPopular:function(){b.popularTab().attr("loaded")||(b.popularTab().html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_LOADING")),Komento.ajax("site.views.profile.getpopularcomments",{uid:b.options.uid},{success:function(a,c,d){b.popularTab().html(a),b.popularTab().attr("loaded",!0),b.loaded.popular=parseInt(c),b.total.popular=parseInt(d)},fail:function(){}}))},loadMorePopular:function(){Komento.ajax("site.views.profile.getpopularcomments",{loadMore:1,uid:b.options.uid,start:b.loaded.popular},{success:function(a,c){b.popularTab().children("ul").append(a),b.loaded.popular+=parseInt(c),b.loaded.popular>=b.total.popular&&b.hideLoadMore("popular"),b.loadMore().enable()},fail:function(){}})},loadSticked:function(){b.stickedTab().attr("loaded")||(b.stickedTab().html('<img src="'+Komento.options.spinner+'" />'+a.language("COM_KOMENTO_LOADING")),Komento.ajax("site.views.profile.getstickedcomments",{uid:b.options.uid},{success:function(a,c,d){b.stickedTab().html(a),b.stickedTab().attr("loaded",!0),b.loaded.sticked=parseInt(c),b.total.sticked=parseInt(d)},fail:function(){}}))},loadMoreSticked:function(){Komento.ajax("site.views.profile.getstickedcomments",{loadMore:1,uid:b.options.uid,start:b.loaded.sticked},{success:function(a,c){b.stickedTab().children("ul").append(a),b.loaded.sticked+=parseInt(c),b.loaded.sticked>=b.total.sticked&&b.hideLoadMore("sticked"),b.loadMore().enable()},fail:function(){}})},hideLoadMore:function(b){a("#kmt-"+b).find(".loadMore").remove()}}}),b.resolve()})}),Komento.module("komento.upload",function(a){var b=this;Komento.require().view("comment/form/uploadrow").library("plupload").done(function(){Komento.Controller("UploadForm",{defaults:{uploadUrl:a.indexUrl+"?option=com_komento&controller=file&task=upload&component="+Komento.component,uploadedId:[],"{uploader}":".uploaderForm","{uploadButton}":".uploadButton","{uploadArea}":".uploadArea","{uploadQueue}":".uploadQueue","{queueHeader}":".queueHeader","{queueRow}":".queueRow","{dragDrop}":".dragDrop","{removeFile}":".removeFile","{fileCounter}":".fileCounter",view:{uploadrow:"comment/form/uploadrow"}}},function(b){return{init:function(){b.uploader().implement("plupload",{settings:{url:b.options.uploadUrl,drop_element:"uploadArea",max_file_size:Komento.options.config.upload_max_size+"mb",filters:[{title:"Allowed File Type",extensions:Komento.options.config.upload_allowed_extension}]},"{uploader}":".uploaderForm","{uploadButton}":".uploadButton"},function(){b.plupload=this.plupload,"html5"==b.plupload.runtime&&b.enableDragDrop()})},"{uploader} FilesAdded":function(a,c,d,e){b.addFiles(e)},"{uploader} UploadComplete":function(){a(".queueRow").each(function(c,d){b.removeRow(a(d).attr("id"))}),b.kmt.form.postComment()},"{uploader} FileUploaded":function(c,d,e,f,g){return 1==g.status&&b.options.uploadedId.push(g.id),"notallowed"==g.status?(b.plupload.stop(),b.kmt.form.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_UPLOAD_NOT_ALLOWED")),void 0):"exceedfilesize"==g.status?(b.plupload.stop(),b.kmt.form.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_MAX_FILE_SIZE",Komento.options.config.upload_max_size+"mb")),void 0):void 0},"{uploader} QueueChanged":function(a,c,d){b.fileCounter().text(d.files.length)},"{uploader} Error":function(c,d,e,f){switch(b.kmt.form.clearNotification(),f.code){case-600:b.kmt.form.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_MAX_FILE_SIZE",Komento.options.config.upload_max_size+"mb"));break;case-601:b.kmt.form.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_FILE_EXTENSION",Komento.options.config.upload_allowed_extension))}},"{removeFile} click":function(a){var c=a.parents(".queueRow").attr("id");b.removeRow(c)},enableDragDrop:function(){b.dragDrop().show()},startUpload:function(){b.plupload.files.length>0?b.plupload.start():b.kmt.form.postComment()},addFiles:function(c){a.each(c,function(c,d){if(b.kmt.form.clearNotification(),b.plupload.files.length>Komento.options.config.upload_max_file)return b.plupload.removeFile(d),b.kmt.form.errorNotification(a.language("COM_KOMENTO_FORM_NOTIFICATION_MAX_FILE_ITEM",Komento.options.config.upload_max_file)),!0;if(1!=d.status)return!0;var e=parseInt(d.size/1024),f=b.view.uploadrow({id:d.id,filename:d.name,size:e});f.data("fileitem",d),b.uploadQueue().append(f)})},removeRow:function(c){a("#"+c).remove();var d=b.plupload.getFile(c);b.plupload.removeFile(d)}}}),b.resolve()})}),Komento.module("location",function(a){var b=this;Komento.require().library("ui/autocomplete").done(function(){Komento.Controller("Location.Form.Simple",{defaultOptions:{language:"en",initialLocation:null,"{locationInput}":".locationInput","{locationLatitude}":".locationLatitude","{locationLongitude}":".locationLongitude","{autoDetectButton}":".autoDetectButton"}},function(b){return{init:function(){b.locationInput().val(a.language("COM_KOMENTO_COMMENT_WHERE_ARE_YOU")),b.locationLongitude().val(""),b.locationLatitude().val(""),b.locationInput().one("focus",function(){b.locationInput().val("")});var c=a.uid("ext");window[c]=function(){a.___GoogleMaps.resolve()},a.___GoogleMaps||(a.___GoogleMaps=a.Deferred(),void 0===window.google||void 0===window.google.maps?Komento.require().script({prefetch:!1},"https://maps.googleapis.com/maps/api/js?sensor=true&language="+b.options.language+"&callback="+c):a.___GoogleMaps.resolve()),a.___GoogleMaps.done(function(){b._init()})},_init:function(){b.geocoder=new google.maps.Geocoder,b.hasGeolocation=void 0!==navigator.geolocation,b.hasGeolocation?b.autoDetectButton().show():b.autoDetectButton().remove(),b.locationInput().autocomplete({delay:300,minLength:0,source:b.retrieveSuggestions,select:function(a,c){b.locationInput().autocomplete("close"),b.setLocation(c.item.location)}}).prop("disabled",!1),b.locationInput().addClass("location-suggestion");var c=a.trim(b.options.initialLocation);c&&b.getLocationByAddress(c,function(a){b.setLocation(a[0])}),b.busy(!1)},busy:function(a){b.locationInput().toggleClass("loading",a)},getUserLocations:function(a){b.getLocationAutomatically(function(c){b.userLocations=b.buildDataset(c),a&&a(c)})},getLocationByAddress:function(a,c){b.geocoder.geocode({address:a},c)},getLocationByCoords:function(a,c,d){b.geocoder.geocode({location:new google.maps.LatLng(a,c)},d)},getLocationAutomatically:function(a,c){return navigator.geolocation?(navigator.geolocation.getCurrentPosition(function(c){b.getLocationByCoords(c.coords.latitude,c.coords.longitude,a)},c),void 0):c("ERRCODE","Browser does not support geolocation or do not have permission to retrieve location data.")},setLocation:function(a){a&&(b.locationResolved=!0,b.lastResolvedLocation=a,b.locationInput().val(a.formatted_address),b.locationLatitude().val(a.geometry.location.lat()),b.locationLongitude().val(a.geometry.location.lng()))},removeLocation:function(){b.locationResolved=!1,b.locationInput().val(""),b.locationLatitude().val(""),b.locationLongitude().val("")},buildDataset:function(b){var c=a.map(b,function(a){return{label:a.formatted_address,value:a.formatted_address,location:a}});return c},retrieveSuggestions:function(a,c){b.busy(!0);var d=a.term,e=function(a){c(a),b.busy(!1)};""==d?e(b.userLocations||[]):b.getLocationByAddress(d,function(a){e(b.buildDataset(a))})},suggestUserLocations:function(){b.hasGeolocation&&b.userLocations&&(b.removeLocation(),b.locationInput().autocomplete("search","")),b.autoDetectButton().text(a.language("COM_KOMENTO_FORM_LOCATION_AUTODETECT")),b.busy(!1)},"{locationInput} blur":function(){setTimeout(function(){var c=a.trim(b.locationInput().val());""==c?b.removeLocation():b.locationResolved?c!=b.lastResolvedLocation.formatted_address&&b.setLocation(b.lastResolvedLocation):b.removeLocation()},250)},"{autoDetectButton} click":function(){b.busy(!0),b.autoDetectButton().text(a.language("COM_KOMENTO_FORM_LOCATION_DETECTING")),b.hasGeolocation&&!b.userLocations?b.getUserLocations(b.suggestUserLocations):b.suggestUserLocations()},"{locationInput} keypress":function(a){a.keypress(function(a){return 13==a.which?!1:void 0})}}}),b.resolve()})}),Komento.module("migrator.actions",function(a){var b=this;Komento.require().script("admin.language","komento.common").done(function(){Komento.Controller("Migrator.Actions",{defaults:{"{migrateButton}":".migrateButton","{deleteButton}":".deleteButton"}},function(b){return{init:function(){b.progress=b.element.find(".migratorProgress"),b.migrator=b.element.find(".migratorTable")},"{migrateButton} click":function(a){a.checkClick()&&b.migrateStart()},migrateStart:function(){b.progress.controller().migratedComments().text("0"),b.progress.controller().progressBar().width("0%"),b.progress.controller().progressPercentage().text("0"),b.progress.controller().progressStatus().html('<img src="'+Komento.options.spinner+'" /> Migrating...'),b.migrator.controller().getStatistic()},migrateComplete:function(){b.progress.controller().progressStatus().text(a.language("COM_KOMENTO_MIGRATORS_PROGRESS_DONE")),b.progress.controller().log(a.language("COM_KOMENTO_MIGRATORS_LOG_COMPLETE")),b.migrateButton().enable()}}}),b.resolve()})}),Komento.module("migrator.common",function(a){var b=this;Komento.Controller("Migrator.Common",{defaults:{"{categoriesList}":"#category","{componentsList}":"#components","{publishingState}":"#publishingState","{migrateLikes}":"#migrateLikes"}},function(b){return{init:function(){b.migrationType=b.element.attr("migration-type"),b.migratorType=b.element.attr("migrator-type"),b.progress=b.element.find(".migratorProgress"),b.actions=b.element.parents(".tab")},getStatistic:function(){var c,d;switch(b.migrationType){case"component":d="components",c=b.componentsList().val();break;case"article":d="categories",c=b.categoriesList().val();break;case"custom":d="data",c=a(".migrator-custom-data").controller().getData()}var e={};e[d]=c,Komento.ajax("admin.views.migrators.getmigrator",{type:b.migratorType,"function":"getstatistic",params:e},{success:function(a,c){b.progress.controller().setTotalPosts(a.length),b.progress.controller().setTotalComments(c),c>0&&("custom"==b.migratorType?b.migrateCustom(e,0,c):b.migrate(a,0,a[0]))},log:function(a){b.progress.controller().log(a)}})},migrate:function(a,c,d){if(void 0===d)return b.actions.controller().migrateComplete(),void 0;switch(b.migrationType){case"article":var e=d;d={component:b.migratorType,cid:e}}var f=b.publishingState().val(),g=b.migrateLikes().is(":checked")?1:0;Komento.ajax("admin.views.migrators.getmigrator",{type:b.migratorType,"function":"migrate",params:{component:d.component,cid:d.cid,publishingState:f,migrateLikes:g}},{success:function(){b.migrate(a,c+1,a[c+1])},fail:function(a){b.progress.controller().log("error: "+a)},update:function(a){b.progress.controller().updateMigratedComments(a)},log:function(a){b.progress.controller().log(a)}})},migrateCustom:function(a,c,d){return c>=d?(b.actions.controller().migrateComplete(),void 0):(a.data.start=c,Komento.ajax("admin.views.migrators.getmigrator",{type:b.migratorType,"function":"migrate",params:a},{success:function(c){b.migrateCustom(a,c,d)},fail:function(a){b.progress.controller().log("error: "+a)},update:function(a){b.progress.controller().updateMigratedComments(a)},log:function(a){b.progress.controller().log(a)}}),void 0)}}}),b.resolve()}),Komento.module("migrator.custom",function(a){var b=this;Komento.Controller("Migrator.Custom",{defaults:{"{migrateTable}":"#migrate-table","{componentFilter}":"#migrate-component-filter","{tableColumns}":".table-columns","{cycleAmount}":"#migrate-cycle"}},function(b){return{init:function(){b.loadTableColumns()},"{migrateTable} change":function(){b.loadTableColumns()},loadTableColumns:function(){var c=b.migrateTable().val(),d={tableName:c};Komento.ajax("admin.views.migrators.getmigrator",{type:"custom","function":"getColumns",params:d},{success:function(c){b.tableColumns().each(function(b,d){var e=c;a(d).data("required")||(e='<option value="kmt-none">none</option>'+c),a(d).html(e)})}})},getData:function(){var c={};return c.table=b.migrateTable().val(),b.tableColumns().each(function(b,d){var e=a(d).attr("id").slice(15);c[e]=a(d).val()}),c.componentFilter=b.componentFilter().val(),c.cycle=b.cycleAmount().val(),c}}}),b.resolve()}),Komento.module("migrator.progress",function(){var b=this;Komento.require().script("admin.language","komento.common").done(function(){Komento.Controller("Migrator.Progress",{defaults:{"{progressBar}":".progressBar","{progressStatus}":".progressStatus","{progressPercentage}":".progressPercentage","{logList}":".logList","{clearLog}":".clearLog","{totalComments}":".totalComments","{totalPosts}":".totalPosts","{migratedComments}":".migratedComments"}},function(a){return{init:function(){},"{clearLog} click":function(){a.logList().html("")},setTotalPosts:function(b){a.totalPosts().text(b)},setTotalComments:function(b){a.totalComments().text(b)},updateMigratedComments:function(b){var c=a.migratedComments().text(),d=parseInt(c)+parseInt(b);a.migratedComments().text(d);var e=parseInt(a.totalComments().eq(0).text()),f=Math.ceil(d/e*100);a.progressBar().animate({width:f.toString()+"%"}),a.progressPercentage().text(f)},log:function(b){var c=new Date,d=c.getHours()>9?c.getHours():"0"+c.getHours(),e=c.getMinutes()>9?c.getMinutes():"0"+c.getMinutes(),f=c.getSeconds()>9?c.getSeconds():"0"+c.getSeconds(),g="["+d+":"+e+":"+f+"]",h="<li>"+g+" "+b+"</li>",i=a.logList()[0].scrollHeight;a.logList().append(h).scrollTop(i)}}}),b.resolve()})})});